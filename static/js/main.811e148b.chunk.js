(this["webpackJsonpinteractive-network"]=this["webpackJsonpinteractive-network"]||[]).push([[0],{102:function(e,t,a){e.exports=a(147)},107:function(e,t,a){},141:function(e,t){},142:function(e,t){},143:function(e,t){},144:function(e,t){},145:function(e,t){},146:function(e,t){},147:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),i=a(18),l=a.n(i);a(107),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var s=a(6),o=a(87),c=a(176),u=a(86),h=a.n(u),p=a(12),m=a(49),d=a(170),f=a(178),g=a(179),v=a(173),y=a(56),b=a.n(y),w=a(24),x=a.n(w),k=a(5);var E=function(e){var t=e.imgArr,a=e.scale,i=Object(n.useRef)(null),l=Object(n.useRef)(null);return Object(n.useEffect)((function(){l.current||(l.current=new x.a((function(e){e._draw=function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(t)if(e._setupDone){var n=t.length,r=t[0].length;n===e.height&&r===e.width||e.resizeCanvas(r,n),e.canvas.style.height=n*a+"px",e.canvas.style.width=r*a+"px",e.clear();var i=t.flat(),l=Math.max.apply(Math,Object(k.a)(i));l=l>0?l:-Math.min.apply(Math,Object(k.a)(i)),t=t.map((function(e){return e.map((function(e){return e/l}))})),e.loadPixels();for(var s=0;s<t.length;s+=1)for(var o=0;o<t[0].length;o+=1){var c=255*t[s][o];c>=0?e.set(o,s,e.color(0,0,0,c)):c<0&&e.set(o,s,e.color(214,30,30,.75*-c))}e.updatePixels()}else setTimeout((function(){return e._draw(t,a)}),10)},e.setup=function(){e.pixelDensity(1),e.createCanvas(1,1),e.stroke(255),e.noLoop(),e.noSmooth()}}),i.current)),l.current&&l.current._draw(t,a)}),[t,a]),r.a.createElement("div",{ref:i})},_=function(e){var t=e.imgArrs,a=e.cols,n=e.scale;return r.a.createElement(d.a,{container:!0,spacing:1,style:e.style},t.map((function(e,t){return r.a.createElement(d.a,{item:!0,key:t,style:a&&t%a===a-1?{breakAfter:"always"}:{}},r.a.createElement(E,{imgArr:e,scale:n}))})))},M=a(181),O=a(172),j=a(180),S=a(10),A=a.n(S),I=["I","i","L","T","X","Y",">","_/",")","\u2b51"];function T(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return function(n,r){var i=2*Math.PI/t*(n*Math.cos(e)+r*Math.sin(e));return i>Math.PI*a||i<-Math.PI*a?null:Math.cos(i)}}function C(e){return function(t,a){return Math.exp(-.5*(Math.pow(t,2)/Math.pow(e,2)+Math.pow(a,2)/Math.pow(e,2)))}}function z(e,t,a,n){for(var r=T(t,a),i=C(n),l=A.a.zeros([e,e]).assign(-1,!1).tolist(),s=Math.floor(e/2),o=0;o<e;o+=1)for(var c=o-s,u=0;u<e;u+=1){var h=u-s,p=r(h,c);null!==p&&(l[o][u]=p),l[o][u]=l[o][u]*i(h,c)}return l}function B(e,t,a,n){for(var r=T(t,a),i=C(n),l=A.a.zeros([e,e]).assign(-1,!1).tolist(),s=Math.floor(e/2),o=0;o<e;o+=1)for(var c=o-s,u=0;u<e;u+=1){var h=u-s,p=null,m=Math.sin(t)*h-Math.cos(t)*c;m<1e-5?p=r(h,c):m<1.00001&&(p=(p=r(h,c))>0?p/2:p),null!==p&&(l[o][u]=p),l[o][u]=l[o][u]*i(h,c)}return l}function N(e,t,a,n,r){for(var i=2*Math.PI/a,l=Math.floor(e/2),s=[],o=0;o<a;o+=1){for(var c=o*i,u=Math.sin(c+Math.PI/2-t/2),h=Math.cos(c+Math.PI/2-t/2),p=B(e,c,n,r),m=B(e,c-t,n,r),d=A.a.zeros([e,e]).tolist(),f=0;f<e;f+=1)for(var g=f-l,v=0;v<e;v+=1){var y=u*(v-l)-h*g;d[f][v]=y<1e-5?p[f][v]:m[f][v]}s.push(d)}return s}function D(e,t,a){for(var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=C(a),i=C(n*t/4),l=A.a.zeros([e,e]).assign(-1,!1).tolist(),s=Math.floor(e/2),o=0;o<e;o+=1)for(var c=o-s,u=0;u<e;u+=1){var h=u-s;l[o][u]=8*i(h,c)-r(h,c)}var p=Math.max.apply(Math,Object(k.a)(l.flat()));return l.map((function(e){return e.map((function(e){return e/p}))}))}function P(e){var t,a=0,n=0,r=0;e.forEach((function(e){return e.forEach((function(e){e>0?(a+=e,e>n&&(n=e)):e<r&&(r=e)}))})),t=0===n||0===r?1:-r/(n/a);var i=a;return e=e.map((function(e){return e.map((function(e){return e>0?e/i:e/t}))}))}function G(e,t,a,n,r){var i=[];if(!e||!t)return i;r.includes(I[0])&&i.push.apply(i,Object(k.a)(function(e,t,a,n){for(var r=Math.PI/t,i=[],l=0;l<t;l+=1){var s=z(e,l*r,a,n);i.push(s)}return i}(e,t,a,n))),r.includes(I[1])&&i.push.apply(i,Object(k.a)(function(e,t,a,n){for(var r=2*Math.PI/t,i=[],l=0;l<t;l+=1){var s=B(e,l*r,a,n);i.push(s)}return i}(e,2*t,a,n))),r.includes(I[2])&&i.push.apply(i,Object(k.a)(N(e,.5*Math.PI,2*t,a,n))),r.includes(I[3])&&i.push.apply(i,Object(k.a)(function(e,t,a,n,r){for(var i=2*Math.PI/a,l=Math.floor(e/2),s=[],o=0;o<a;o+=1){for(var c=o*i,u=Math.sin(c+Math.PI/2),h=Math.cos(c+Math.PI/2),p=z(e,c,n,r),m=B(e,c-t,n,r),d=A.a.zeros([e,e]).tolist(),f=0;f<e;f+=1)for(var g=f-l,v=0;v<e;v+=1){if(u*(v-l)-h*g<1e-5)d[f][v]=p[f][v];else{var y=Math.max(p[f][v],m[f][v]),b=Math.min(p[f][v],m[f][v]);d[f][v]=y>0?y:b}}s.push(d)}return s}(e,.5*Math.PI,2*t,a,n))),r.includes(I[4])&&i.push.apply(i,Object(k.a)(function(e,t,a,n,r){for(var i=Math.PI/2/a,l=[],s=0;s<a;s+=1){for(var o=s*i,c=z(e,o,n,r),u=z(e,o-t,n,r),h=A.a.zeros([e,e]).tolist(),p=0;p<e;p+=1)for(var m=0;m<e;m+=1){var d=Math.max(c[p][m],u[p][m]),f=Math.min(c[p][m],u[p][m]);h[p][m]=d>0?d:f}l.push(h)}return l}(e,.5*Math.PI,t/2,a,n))),r.includes(I[5])&&i.push.apply(i,Object(k.a)(function(e,t,a,n,r){for(var i=2*Math.PI/a,l=Math.floor(e/2),s=[],o=0;o<a;o+=1){for(var c=o*i,u=B(e,c,n,r),h=B(e,c-Math.PI+t,n,r),p=B(e,c-Math.PI-t,n,r),m=Math.sin(c),d=Math.cos(c),f=A.a.zeros([e,e]).tolist(),g=0;g<e;g+=1)for(var v=g-l,y=0;y<e;y+=1){if(m*(y-l)-d*v<-1.00001)f[g][y]=u[g][y];else{var b=Math.max(h[g][y],p[g][y],u[g][y]),w=Math.min(h[g][y],p[g][y],u[g][y]);f[g][y]=b>0?b:w}}s.push(f)}return s}(e,.25*Math.PI,2*t,a,n))),r.includes(I[6])&&i.push.apply(i,Object(k.a)(N(e,.25*Math.PI,2*t,a,n))),r.includes(I[7])&&i.push.apply(i,Object(k.a)(N(e,.75*Math.PI,2*t,a,n))),r.includes(I[8])&&i.push.apply(i,Object(k.a)(N(e,.925*Math.PI,2*t,a,n))),r.includes(I[9])&&(i.push(D(e,a,n,.7)),i.push(D(e,a,n,1)));var l=i.map(P);return r.includes(I[9])&&(l.push(A.a.zeros([e,e]).assign(1/(e*e),!1).tolist()),l.push(A.a.zeros([e,e]).assign(-.25,!1).tolist())),console.log(l.map((function(e){return e.map((function(e){return e.join(",")})).join("\n")})).join("\n:\n")),l}var R=Object(n.memo)((function(e){return r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement("div",null,"Types"),r.a.createElement(j.a,{value:e.types,onChange:function(t,a){return a.length>0?e.onChange("types",a):0},"aria-label":"types of kernels",style:{borderRadius:0,margin:"12px 0 0 0"},className:"toggle-types"},I.slice(0,5).map((function(e,t){return r.a.createElement(O.a,{key:e,value:e,style:{borderRadius:0,height:"28px",width:"28px",textTransform:"none",padding:"4px",textAlign:"center"}},e)}))),r.a.createElement(j.a,{value:e.types,onChange:function(t,a){return a.length>0?e.onChange("types",a):0},"aria-label":"types of kernels",style:{borderRadius:0,margin:"2px 0 12px 0"},className:"toggle-types"},I.slice(5,10).map((function(e,t){return r.a.createElement(O.a,{key:e,value:e,style:{borderRadius:0,height:"28px",width:"28px",textTransform:"none",padding:"4px",textAlign:"center"}},e)})))),r.a.createElement("div",null,r.a.createElement("div",null,"Angles"),r.a.createElement(M.a,{defaultValue:e.numComponents,track:!1,"aria-labelledby":"number of components",marks:[1,2,3,4,5].map((function(e){return{value:e,label:Math.pow(2,e)}})),step:1,min:1,max:5,onChange:function(t,a){return e.onChange("numComponents",a)}})),r.a.createElement("div",null,r.a.createElement("div",null,"Size"),r.a.createElement(M.a,{defaultValue:e.windowSize,track:!1,"aria-labelledby":"window size",valueLabelDisplay:"auto",marks:[3,5,7,9,11,13,15].map((function(e){return{value:e,label:e}})),step:2,min:3,max:15,onChange:function(t,a){return e.onChange("windowSize",a)}})),r.a.createElement("div",null,r.a.createElement("div",null,"Width Factor"),r.a.createElement(M.a,{defaultValue:e.lambda,track:!1,"aria-labelledby":"lambda",valueLabelDisplay:"auto",step:.1,min:1.1,max:10,onChange:function(t,a){return e.onChange("lambda",a)},style:{padding:"24px 0"}})),r.a.createElement("div",null,r.a.createElement("div",null,"Gaussian Spread"),r.a.createElement(M.a,{defaultValue:e.sigma,track:!1,"aria-labelledby":"sigma",valueLabelDisplay:"auto",step:.1,min:.1,max:8,onChange:function(t,a){return e.onChange("sigma",a)},style:{padding:"24px 0"}})))}));var L=function(e){var t=e.defaultKernelSettings,a=e.updateKernelSettings,i=Object(n.useState)(t),l=Object(s.a)(i,2),o=l[0],c=l[1],u=o.numComponents,h=o.lambda,y=o.sigma,w=o.windowSize,x=o.types,k=Object(n.useRef)(null),E=Object(n.useCallback)((function(e,t){var n=Object(m.a)({},o,Object(p.a)({},e,t));c(n),k.current&&clearTimeout(k.current),k.current=setTimeout((function(){a(n)}),100)}),[c,o,a]),M=Object(n.useMemo)((function(){return G(w,Math.pow(2,u),h,y,x)}),[u,h,y,w,x]);return r.a.createElement(f.a,{defaultExpanded:!0,square:!0,style:{boxShadow:"none",border:"1px solid #b2b2b2"}},r.a.createElement(g.a,{expandIcon:r.a.createElement(b.a,null),"aria-controls":"kerneltuner-content"},r.a.createElement("h3",{style:{margin:"0 10px"}},"Kernel Maker")),r.a.createElement(v.a,{style:{margin:"10px 20px"}},r.a.createElement(d.a,{container:!0,justify:"flex-start",spacing:4},r.a.createElement(d.a,{item:!0,style:{marginRight:"20px",width:"165px"}},r.a.createElement(R,{numComponents:u,lambda:h,sigma:y,windowSize:w,types:x,onChange:E})),r.a.createElement(d.a,{item:!0,style:{width:"calc(100% - 220px)"}},r.a.createElement(_,{imgArrs:M,scale:4,cols:8})))))},W=a(174),F=a(65),K=Object(n.memo)((function(e){var t=Object(n.useState)(e.defaultValue),a=Object(s.a)(t,2),i=a[0],l=a[1],o=Object(n.useCallback)(Object(F.debounce)(e.onChange,e.timer||0),[e]);return r.a.createElement(M.a,Object.assign({value:i},e,{onChange:function(e,t){l(t),o(e,t)}}))})),V=a(21),Y=a(17),J=a(7),U="float32",X=function(){function e(t,a,n,r){var i,l=this;Object(V.a)(this,e),this._shape=a,this._stride=r,this._pad=Math.floor(n/2),0!==this._pad?(i=this._shape.map((function(e){return e+2*l._pad})),this._outerBounds=[-this._pad,-this._pad,this._shape[1]+this._pad,this._shape[0]+this._pad]):(i=a.map((function(e){return Math.ceil(e/l._stride)*l._stride})),this._outerBounds=[0,0,i[1],i[0]]);var o=i,c=Object(s.a)(o,2),u=c[0],h=c[1];this._channels=t,this._arr=A.a.zeros([t,u,h],U),this._ids=A.a.zeros(this._shape,"int32").assign(-1,!1),this._max=A.a.zeros(this._shape,U),this._dirtyBounds=null}return Object(Y.a)(e,[{key:"assign",value:function(e,t,a){null===t?this._slice(a).assign(e,!1):this._slice(a).slice([t,t+1],null,null).assign(e,!1),this._updateDirtyBounds(a)}},{key:"clean",value:function(){this._dirtyBounds=null}},{key:"calcStats",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"cpu";if(this._dirtyBounds){var a,n;t&&(n=J.b());var r,i=Object(s.a)(this._dirtyBounds,4),l=i[0],o=i[1],c=i[2],u=i[3],h=u-o,p=c-l,m=[],d=Date.now();t&&J.g(t),m.push(J.b());var f=e.argMax(1);t&&J.g(n),r=Date.now(),m.push("argmax -> "),m.push(r-d),d=r,m.push(J.b());var g=f.dataSync();r=Date.now(),m.push("data sync -> "),m.push(r-d),d=r,m.push(J.b());var v=A.a.int32(g);v=v.reshape([h,p]);var y=this._ids.slice([o,u],[l,c]);y.assign(v,!1),r=Date.now(),m.push("update _ids -> "),m.push(r-d),d=r,m.push(J.b());var b=e.reshape([-1]),w=f.reshape([-1]),x=J.d(w,J.f(p*h,"int32")),k=J.e(0,h*p,1,"int32"),E=J.a(x,k);r=Date.now(),m.push("prepare gather -> "),m.push(r-d),d=r,t&&J.g(t),m.push(J.b());var _=b.gather(E);t&&J.g(n),r=Date.now(),m.push("gather -> "),m.push(r-d),d=r,m.push(J.b());var M=A.a[U](_.dataSync()).reshape([h,p]),O=this._max.slice([o,u],[l,c]);O.assign(M,!1),r=Date.now(),m.push("update _max -> "),m.push(r-d),d=r,(a=console).log.apply(a,["calc stats:",t,"total time -> ",m.reduce((function(e,t){return Number.isInteger(t)?e+t:e}),0)].concat(m))}}},{key:"_slice",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e||(e=[0,0].concat(Object(k.a)(this._shape)));var t=e,a=Object(s.a)(t,4),n=a[0],r=a[1],i=a[2],l=a[3];return this._arr.slice(null,[r+this._pad,l+this._pad],[n+this._pad,i+this._pad])}},{key:"_updateDirtyBounds",value:function(e){if(this._dirtyBounds){var t=Object(s.a)(e,4),a=t[0],n=t[1],r=t[2],i=t[3],l=Object(s.a)(this._dirtyBounds,4),o=l[0],c=l[1],u=l[2],h=l[3];this._dirtyBounds=[Math.min(a,o),Math.min(n,c),Math.max(r,u),Math.max(i,h)]}else this._dirtyBounds=e}},{key:"print",value:function(){this.arr.tolist().forEach((function(e){return console.table(e)}))}},{key:"printBacking",value:function(){this._arr.tolist().forEach((function(e){return console.table(e)}))}},{key:"dirty",get:function(){return this._dirtyBounds?this._slice(this.dirtyBounds):null}},{key:"dirtyBounds",get:function(){var e=this;if(!this._dirtyBounds)return null;var t=this._dirtyBounds;if(0!==this._pad&&(t=function(e,t){if(!e||!t)return e;var a=Object(s.a)(e,4),n=a[0],r=a[1],i=a[2],l=a[3],o=Object(s.a)(t,4),c=o[0],u=o[1],h=o[2],p=o[3],m=Math.max(n,c),d=Math.max(r,u),f=Math.min(i,h),g=Math.min(l,p);return[m,d,f,g]}(t=q(this._dirtyBounds,2*this._pad),this._outerBounds)),1!==this._stride){var a=t=t.map((function(t){return t/e._stride})),n=Object(s.a)(a,4),r=n[0],i=n[1],l=n[2],o=n[3];t=(t=[Math.floor(r),Math.floor(i),Math.ceil(l),Math.ceil(o)]).map((function(t){return t*e._stride}))}return t}},{key:"arr",get:function(){return this._slice([0,0,this._shape[1],this._shape[0]])}}],[{key:"pool",value:function(t,a,n){return new e(t,a,0,n)}},{key:"conv",value:function(t,a,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return new e(t,a,n,r)}}]),e}();function q(e,t){if(!e||0===e.length||!t)return e;var a=Object(s.a)(e,4);return[a[0]-t,a[1]-t,a[2]+t,a[3]+t]}var H=function(){function e(t,a,n,r){Object(V.a)(this,e),this.input=t,this.output=a,this._kernelSize=r,this._pad=Math.floor(r/2),this._rawFilters=n,this.filters=n.map((function(e){return e.map((function(e){return e?A.a[U]([e]):null}))})),this._tflayer=function(e,t){var a=e.shape[0],n=e.transpose(2,3,1,0).tolist(),r=A.a.zeros([a]).tolist();e.tolist().forEach((function(e,t){0===e.flat().flat().filter((function(e){return e>0})).length&&(r[t]=64)}));var i=[J.i(n),J.h(r)];return J.c.conv2d({filters:a,kernelSize:t,strides:1,padding:"valid",weights:i,activation:"relu",dataFormat:"channelsFirst"})}(A.a[U](n.map((function(e){return e.map((function(e){return e||A.a.zeros([r,r],U).tolist()}))}))),r)}return Object(Y.a)(e,[{key:"runWith",value:function(e){var t,a,n,r=this.input.dirty,i=[],l=Date.now(),s=r.reshape([1].concat(Object(k.a)(r.shape))).selection,o=J.i(s.data,s.shape);a=Date.now(),i.push("to tensor -> "),i.push(a-l),l=a,e&&(n=J.b(),J.g(e)),i.push(J.b());var c=this._tflayer.apply(o);e&&J.g(n),a=Date.now(),i.push("apply conv -> "),i.push(a-l),l=a,i.push(J.b());var u=c.dataSync();a=Date.now(),i.push("data sync -> "),i.push(a-l),l=a,i.push(J.b());var h=A.a[U](u);return a=Date.now(),i.push("to array -> "),i.push(a-l),l=a,(t=console).log.apply(t,["conv stats:",e,"total time -> ",i.reduce((function(e,t){return Number.isInteger(t)?e+t:e}),0)].concat(i)),{output:c,updateArr:h}}},{key:"run",value:function(){var e=q(this.input.dirtyBounds,-this._pad),t=Object(s.a)(e,4),a=t[0],n=t[1],r=t[2],i=t[3]-n,l=r-a,o=i*l*this._kernelSize*this._rawFilters.length;J.g("cpu");var c,u=i*l>=22500||o>8e6,h="".concat(l," x ").concat(i," x ").concat(this._kernelSize," x ").concat(this._rawFilters.length," = ").concat(o);u?(console.log("dirty size x kernel x kernels -> ",h," -> electing webgl backend"),c=this.runWith("webgl")):(console.log("dirty size x kernel x kernels -> ",h," -> electing cpu backend"),c=this.runWith("cpu"));var p=c,m=p.output,d=p.updateArr,f=[this.output._channels,i,l],g=d.reshape(f);this.output.assign(g,null,e),u?this.output.calcStats(m,"webgl"):this.output.calcStats(m,"cpu"),this.input.clean()}}]),e}();var Z=function(){function e(t,a,n){Object(V.a)(this,e),this.input=t,this.output=a,this.poolSize=n,this._tflayer=J.c.maxPooling2d({poolSize:n,dataFormat:"channelsFirst"})}return Object(Y.a)(e,[{key:"run",value:function(){var e=this,t=this.input.dirty,a=this.input.dirtyBounds.map((function(t){return Math.ceil(t/e.poolSize)})),n=Object(s.a)(a,4),r=n[0],i=n[1],l=n[2],o=n[3]-i,c=l-r,u=o*c;u>3e3?(J.g("webgl"),console.log("opting to use webgl")):J.g("cpu");var h=t.reshape([1].concat(Object(k.a)(t.shape))).selection,p=J.i(h.data,h.shape),m=this._tflayer.apply(p),d=[this.output._channels,o,c],f=A.a[U](m.dataSync()).reshape(d);J.g("cpu"),this.output.assign(f,null,a),u>3e3?this.output.calcStats(m,"webgl"):this.output.calcStats(m,"cpu"),this.input.clean()}}]),e}(),Q=function(){function e(t,a){var n=this;Object(V.a)(this,e),this.layerInfos=a,this.arrs=[];var r=1,i=t,l=!0,o=!1,c=void 0;try{for(var u,h=function(){var e=u.value,t=void 0;"conv2d"===e.type?(t=X.conv(r,i,e.kernelSize),r=e.filters.length):"maxPool2d"===e.type&&(t=X.pool(r,i,e.poolSize),i=i.map((function(t){return Math.ceil(t/e.poolSize)}))),n.arrs.push(t)},p=a[Symbol.iterator]();!(l=(u=p.next()).done);l=!0)h()}catch(M){o=!0,c=M}finally{try{l||null==p.return||p.return()}finally{if(o)throw c}}this.arrs.push(X.conv(r,i,0)),this.layers=[];var m=!0,d=!1,f=void 0;try{for(var g,v=a.entries()[Symbol.iterator]();!(m=(g=v.next()).done);m=!0){var y=g.value,b=Object(s.a)(y,2),w=b[0],x=b[1],k=this.arrs[w],E=this.arrs[w+1],_=void 0;"conv2d"===x.type?_=new H(k,E,x.filters,x.kernelSize):"maxPool2d"===x.type&&(_=new Z(k,E,x.poolSize)),this.layers.push(_)}}catch(M){d=!0,f=M}finally{try{m||null==v.return||v.return()}finally{if(d)throw f}}}return Object(Y.a)(e,[{key:"run",value:function(e,t){this.arrs[0].assign(e,0,t);var a=Date.now(),n=!0,r=!1,i=void 0;try{for(var l,o=this.layers.entries()[Symbol.iterator]();!(n=(l=o.next()).done);n=!0){var c=l.value,u=Object(s.a)(c,2),h=u[0],p=u[1],m=Date.now();p.run();var d=Date.now();console.log("time for layer "+h,d-m)}}catch(g){r=!0,i=g}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}var f=Date.now();console.log("total network time",f-a),this.arrs[this.arrs.length-1].clean()}},{key:"getOutput",value:function(e){var t=this.arrs[e+1];return{acts:t.arr,max:t._max,ids:t._ids}}}]),e}();function $(e,t,a){return e<t?t:e>=a?a-.001:e}function ee(e,t){var a=Object(s.a)(t,4),n=a[0],r=a[1],i=a[2],l=a[3],o=$(e.x,n,i),c=$(e.y,r,l);return new x.a.Vector(o,c)}var te=function(){function e(t,a,n){Object(V.a)(this,e),this.p=t,this.shape=a,this.layerInfos=n,this.network=new Q(this.shape,n),this._dirtyBounds=null,this._backup=null,this._listeners=[]}return Object(Y.a)(e,[{key:"init",value:function(){var e=this;this.p._setupDone?this.forceFullUpdate():setTimeout((function(){return e.init()}),10)}},{key:"reset",value:function(){this.p.clear(),this.forceFullUpdate()}},{key:"addSegment",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e=ee(e,this.bounds),t=ee(t,this.bounds);var n,r=this._getLineBounds(e,t);a&&(null!==this._backup&&console.log("Overwriting existing backup! Should call restore() first"),this._backup={img:(n=this.p).get.apply(n,Object(k.a)(r)),bounds:r});this.p.line(e.x,e.y,t.x,t.y),this._updateDirtyBounds(r)}},{key:"restore",value:function(){if(null!==this._backup){var e=this._backup,t=e.img,a=e.bounds,n=a.slice(0,2),r=Object(s.a)(n,2),i=r[0],l=r[1];this.p.image(t,i,l),this._backup=null,this._updateDirtyBounds(a)}else console.log("Backup failed, no backup cache available")}},{key:"update",value:function(){if(this._dirtyBounds){var e=Object(s.a)(this._dirtyBounds,4),t=e[0],a=e[1],n=e[2],r=e[3],i=this.p.get(t,a,n-t,r-a);i.loadPixels();var l=A.a[U](i.pixels).reshape(i.height,i.width,4).slice(null,null,[3,4]).reshape(1,i.height,i.width);this.network.run(l,this._dirtyBounds),this._notifyListeners({network:this.network,dirtyBounds:Object(k.a)(this._dirtyBounds)}),this._dirtyBounds=null}}},{key:"forceFullUpdate",value:function(){this._dirtyBounds=this.bounds,this.update()}},{key:"_updateDirtyBounds",value:function(e){if(this._dirtyBounds){var t=Object(s.a)(e,4),a=t[0],n=t[1],r=t[2],i=t[3],l=Object(s.a)(this._dirtyBounds,4),o=l[0],c=l[1],u=l[2],h=l[3];this._dirtyBounds=[Math.min(a,o),Math.min(n,c),Math.max(r,u),Math.max(i,h)]}else this._dirtyBounds=e}},{key:"_getLineBounds",value:function(e,t){return[Math.min(e.x,t.x)-1,Math.min(e.y,t.y)-1,Math.max(e.x,t.x)+1+1,Math.max(e.y,t.y)+1+1].map((function(e){return Math.floor(e)}))}},{key:"addListener",value:function(e){this._listeners.push(e)}},{key:"removeListener",value:function(e){var t=this._listeners.indexOf(e);t>-1&&this._listeners.splice(t,1)}},{key:"_notifyListeners",value:function(){var e=!0,t=!1,a=void 0;try{for(var n,r=this._listeners[Symbol.iterator]();!(e=(n=r.next()).done);e=!0){var i=n.value;i&&i.apply(void 0,arguments)}}catch(l){t=!0,a=l}finally{try{e||null==r.return||r.return()}finally{if(t)throw a}}}},{key:"bounds",get:function(){var e=Object(s.a)(this.shape,2),t=e[0];return[0,0,e[1],t]}}]),e}();var ae=function(e){var t=e.shape,a=e.kernels,i=e.onUpdate,l=Object(n.useState)(0),o=Object(s.a)(l,2),c=o[0],u=o[1],h=Object(n.useRef)(null),p=Object(n.useRef)(null),m=Object(n.useRef)(null);Object(n.useEffect)((function(){p.current||(p.current=new x.a(function(e,t){var a=!1;return function(n){n.setup=function(){n.pixelDensity(1);var t=Object(s.a)(e,2),a=t[0],r=t[1];n.createCanvas(a,r),n.strokeWeight(2)},n.draw=function(){if(n.mouseIsPressed){var e={x:n.pmouseX,y:n.pmouseY},r={x:n.mouseX,y:n.mouseY};e.x<0||e.y<0||r.x<0||r.y<0||r.x>=n.width||e.x>=n.width||r.y>=n.height||e.y>=n.height||(n._rotationCache&&(n._rotationCache=null),t.current.addSegment(e,r),a=!0)}else a&&(t.current.update(),a=!1)},n.setRotation=function(e){n._rotationCache||(n._rotationCache=n.get()),n.clear(),n.push(),n.angleMode(n.DEGREES),console.log(e,n._rotationCache),n.translate(n.width/2,n.height/2),n.rotate(e),n.translate(-n.width/2,-n.height/2),n.image(n._rotationCache,0,0),n.pop()}}}(t,m),h.current))})),Object(n.useEffect)((function(){var e=[{filters:a.map((function(e){return[e]})),kernelSize:a[0].length,type:"conv2d"}];m.current=new te(p.current,t,e),m.current.addListener(i),m.current.init()}),[a,t,i]),Object(n.useEffect)((function(){p.current._setupDone&&(p.current.setRotation(c),m.current.forceFullUpdate())}),[c]);var f=Object(n.useCallback)((function(){return m.current.reset()}),[]);return r.a.createElement(d.a,{container:!0,direction:"column",spacing:1,style:{position:"relative"}},r.a.createElement(d.a,{item:!0,style:{margin:"0 auto"}},r.a.createElement("div",{ref:h,className:"zoom300"}),r.a.createElement("div",{style:{marginTop:"10px",textAlign:"center"}},r.a.createElement("span",null,"Make a drawing"),r.a.createElement(W.a,{style:{marginLeft:"10px"},variant:"contained",size:"small",color:"primary","aria-label":"clear",onClick:f},"Clear"))),r.a.createElement(d.a,{item:!0,style:{margin:"20px auto",maxWidth:"200px",minWidth:"160px"}},r.a.createElement("div",null,r.a.createElement(K,{defaultValue:c,track:!1,"aria-labelledby":"drawing rotation",valueLabelDisplay:"auto",marks:[{value:-360,label:"-360"},{value:0,label:"0"},{value:360,label:"360"}],step:1,min:-360,max:360,onChange:function(e,t){return u(t)},timer:20})),r.a.createElement("div",{style:{marginTop:"10px",textAlign:"center"}},"Test rotation invariance")))},ne=["#e6194b","#3cb44b","#4363d8","#f58231","#911eb4","#46f0f0","#f032e6","#bcf60c","#fabebe","#008080","#e6beff","#9a6324","#800000","#aaffc3","#808000","#ffd8b1","#000075"],re={};var ie=function(e){var t=e.kernels,a=e.pt,i=e.ids,l=e.max,s=e.scale,o=e.onSelect,c=Object(n.useRef)(null),u=Object(n.useRef)(null);return Object(n.useEffect)((function(){c.current&&(c.current.innerHTML="",u.current=new x.a(function(e){var t=null,a=null,n=1,r=!1,i=!0;return function(e){e.setData=function(e,i){var l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;t=e;var s=Math.max.apply(Math,Object(k.a)(i.flat()));a=i.map((function(e){return e.map((function(e){return e/s}))})),n=l,r=!0},e.setKernels=function(t){e._kernelCache=[];var a=!0,n=!1,r=void 0;try{for(var i,l=t[Symbol.iterator]();!(a=(i=l.next()).done);a=!0){var s=i.value,o=e._getIcon(s);e._kernelCache.push(o)}}catch(c){n=!0,r=c}finally{try{a||null==l.return||l.return()}finally{if(n)throw r}}},e.setup=function(){e.pixelDensity(1),e.createCanvas(300,300),e.stroke(255),e.noSmooth(),e._colorCodedGraphics=e.createGraphics(300,300)},e.draw=function(){if(t&&a){var l=t.length*n,s=t[0].length*n;l===e.height&&s===e.width||(e.resizeCanvas(s,l),e._colorCodedGraphics=e.createGraphics(t[0].length,t.length));var o=Math.floor(e.mouseX/n),c=Math.floor(e.mouseY/n),u=6*n;if(e._isMouseInBounds()&&i){e.clear(),e._drawBackground(t,a,n);var h=[Math.max(0,o-4),Math.max(0,c-4),Math.min(s/n,o+4+1),Math.min(l/n,c+4+1)],p=h[0],m=h[1],d=h[2],f=h[3],g=A.a.array(t).slice([m,f],[p,d]).tolist(),v=A.a.array(a).slice([m,f],[p,d]).tolist();e.push(),e.translate(o*n-4.5*u,c*n-4.5*u),e.push(),e.fill(255),e.noStroke(),e.rect(0,0,g[0].length*u,g.length*u),e.pop(),e._drawIconArray(g,v,u),e.push(),e.noFill(),e.strokeWeight(1),e.stroke("#b2b2b2"),e.rect(0,0,g[0].length*u,g.length*u),e.pop(),e.push(),e.noFill(),e.stroke("#b2b2b2"),e.strokeWeight(1),e.rect(4*u,4*u,u,u),e.pop(),e.pop(),r=!0}else r&&(e.clear(),e._drawBackground(t,a,n),r=!1)}},e._isMouseInBounds=function(){var t=e.height,a=e.width,r=e.mouseX,i=e.mouseY,l=4*n;return r>l&&i>l&&r<a-l&&i<t-l},e.mouseClicked=function(){if(t&&n&&e._isMouseInBounds()){var a=Math.floor(e.mouseX/n),r=Math.floor(e.mouseY/n);e._onSelect&&(e._onSelect({x:a,y:r}),i=!1,setTimeout((function(){i=!0}),150)),e._pt={x:a,y:r}}},e._drawBackground=function(t,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=e._colorCodedGraphics;r.clear(),r.loadPixels();for(var i=0;i<t.length;i+=1)for(var l=0;l<t[0].length;l+=1)if(a[i][l]>=.1){var s=t[i][l];if(s>=0){var o=e._getColor(s);o.setAlpha(255*a[i][l]),r.set(l,i,o)}}if(r.updatePixels(),e.push(),e.scale(n),e.image(r.get(),0,0),e.pop(),e._pt){var c=e._pt,u=c.x,h=c.y,p=t[h][u],m=a[h][u],d=10;if(e.push(),e.translate((u+.5-d/2)*n,(h+.5-d/2)*n),m>.1){e.fill(255),e.noStroke(),e.rect(0,0,n*d,n*d);var f=e._kernelCache[p];e.image(f,0,0,n*d,n*d),e.noFill(),e.stroke(0),e.rect(0,0,n*d,n*d)}else e.fill(255),e.stroke(0),e.rect(0,0,n*d,n*d);e.pop()}},e._drawIconArray=function(t,a){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=0;r<t.length;r+=1)for(var i=0;i<t[0].length;i+=1){var l=a[r][i];if(l>.1){var s=t[r][i];if(s>=0){var o=e._kernelCache[s];e.push(),e.tint(255,255*l),e.image(o,i*n,r*n,n,n),e.pop()}}}},e._getColor=function(t){var a=re[t];return a||(a=ne[t]?e.color(ne[t]):e.color([155*Math.random(),155*Math.random(),155*Math.random()]),re[t]=a),a},e._getIcon=function(t){var a=t.length,n=e.createGraphics(a,a),r=t.flat(),i=Math.max.apply(Math,Object(k.a)(r));i=i>0?i:-Math.min.apply(Math,Object(k.a)(r)),t=t.map((function(e){return e.map((function(e){return e/i}))})),n.loadPixels();for(var l=0;l<t.length;l+=1)for(var s=0;s<t[0].length;s+=1){var o=255*t[l][s];o>0?n.set(s,l,e.color(0,0,0,o)):o<0&&n.set(s,l,e.color(214,30,30,.75*-o))}return n.updatePixels(),n.get()}}}(),c.current))}),[]),Object(n.useEffect)((function(){u.current&&u.current.setKernels(t)}),[t]),Object(n.useEffect)((function(){u.current&&(u.current._pt=a)}),[a]),Object(n.useEffect)((function(){u.current&&i&&l&&u.current.setData(i,l,s)}),[i,l,s]),Object(n.useEffect)((function(){u.current&&(u.current._onSelect=o)}),[o]),r.a.createElement("div",{ref:c,className:"zoom300"})},le=a(39);function se(e,t,a){var n=a.map((function(e,t){return{name:t,value:e/255}})),r=4,i=4,l=4,s=4,o=e.offsetWidth-s-i,c=.5*o,u=le.b().domain(n.map((function(e){return e.name}))).range([s,o-i]).padding(.1),h=le.c().domain([0,1]).range([c-l,r+u.bandwidth()]),p=le.d(e).append("svg").attr("width",o).attr("height",c),m=p.append("g").selectAll(".bar").data(n).enter();m.append("rect").attr("fill","#e0e0e0").attr("stroke","#b2b2b2").style("stroke-width",1).attr("x",(function(e){return u(e.name)})).attr("y",(function(e){return h(e.value?e.value:0)})).attr("height",(function(e){return h(0)-h(e.value?e.value:0)})).attr("width",u.bandwidth()),m.exit().remove(),function(e,t,a){var n=[];a.forEach((function(e,t){var a=Math.max.apply(Math,Object(k.a)(e.map((function(e){return Math.max.apply(Math,Object(k.a)(e.map((function(e){return Math.abs(e)}))))}))));e.forEach((function(e,r){return e.forEach((function(e,i){n.push({kIndex:t,row:r,col:i,v:e/a})}))}))}));var r=e.append("g").selectAll(".pixel").data(n).enter(),i=t.bandwidth()/a[0].length;r.append("rect").attr("fill",(function(e){return e.v>=0?"rgba(0, 0, 0, "+e.v+")":"rgba(214, 30, 30, "+.75*-e.v+")"})).style("stroke-width",0).attr("x",(function(e){return t(e.kIndex)+i*e.col})).attr("y",(function(e){return i*e.row})).attr("height",i).attr("width",i),e.append("g").selectAll(".outline").data(a).enter().append("rect").attr("x",(function(e,a){return t(a)})).attr("y",0).attr("height",t.bandwidth()).attr("width",t.bandwidth()).style("stroke","#b2b2b2").style("fill","none").style("stroke-width",1)}(p,u,t);return p.append("g").style("font-size","0").call((function(e){return e.attr("transform","translate(0,".concat(c-l,")")).attr("color","#b2b2b2").call(le.a(u).tickSize(0))})),p.node()}var oe=function(e){var t=Object(n.useRef)(null),a=e.kernels,i=e.acts;return Object(n.useEffect)((function(){t.current.innerHTML="",a&&i&&se(t.current,a,i)}),[a,i]),r.a.createElement("div",{ref:t,style:e.style})},ce=function(e){var t=e.imgArrs,a=e.imgArrsOverlay,n=e.scale,i=e.overlayOpacity;return r.a.createElement("div",{style:Object(m.a)({},e.style,{position:"relative"})},r.a.createElement(_,{imgArrs:t,scale:n}),r.a.createElement(_,{imgArrs:a,scale:n,style:{position:"absolute",top:"4px",opacity:i||.75}}))};var ue=function(e){var t=e.acts,a=e.kernels,n=e.count,i=e.imgArr,l=e.pt;if(!t||!l||!a||a.length!==t.length)return null;var s=l.x,o=l.y,c=t.map((function(e){return e[o][s]})),u=function(e,t,a){var n=t.x,r=t.y,i=[n-a,r-a,n+a+1,r+a+1],l=i[0],s=i[1],o=i[2],c=i[3];return l<0||s<0||o>e[0].length||c>e.length?null:A.a.array(e).slice([s,c],[l,o]).tolist()}(i,l,(a[0].length-1)/2),h=function(e,t){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]>t[1]?-1:1})).slice(0,t).map((function(e){return e[0]}))}(c,n);a=h.map((function(e){return a[e]})),c=h.map((function(e){return c[e]}));var p="(".concat(l.x,", ").concat(l.y,")");return r.a.createElement("div",{style:{width:"200px"}},r.a.createElement("div",null,r.a.createElement(oe,{kernels:a,acts:c,style:{margin:"10px auto"}}),r.a.createElement("div",{style:{margin:"5px 0 25px 0",textAlign:"center"}},"Top activations at ",p)),u&&r.a.createElement("div",null,r.a.createElement(ce,{imgArrs:new Array(a.length).fill(u),imgArrsOverlay:a,scale:4.5,overlayOpacity:.8,style:{margin:"10px auto"}}),r.a.createElement("div",{style:{margin:"10px 0",textAlign:"center"}},"Kernel overlays at ",p)))};var he=function(e){var t=e.data,a=e.kernels,i=e.defaultPt,l=Object(n.useState)(i),o=Object(s.a)(l,2),c=o[0],u=o[1],h=Object(n.useMemo)((function(){if(t&&t.network){var e=t.network.getOutput(-1).acts,a=t.network.getOutput(0),n=a.acts,r=a.max,i=a.ids;return{imgArr:e.tolist()[0],acts:n.tolist(),max:r.tolist(),ids:i.tolist()}}return{}}),[t]),p=h.imgArr,m=h.acts,f=h.max,g=h.ids;return r.a.createElement(d.a,{container:!0,spacing:4,justify:"center",style:e.style},r.a.createElement(d.a,{item:!0},r.a.createElement("div",null,r.a.createElement(ie,{kernels:a,max:f,ids:g,scale:3,onSelect:u,pt:c}),r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement("div",{style:{marginTop:"10px"}},"Select to inspect")))),r.a.createElement(d.a,{item:!0},r.a.createElement(ue,{kernels:a,imgArr:p,acts:m,pt:c,count:Math.min(8,a.length),style:{width:"400px"}})))},pe=[100,100],me={x:Math.floor(pe[0]/2)-1,y:Math.floor(pe[1]/2)-1};var de=function(e){var t=Object(n.useState)(null),a=Object(s.a)(t,2),i=a[0],l=a[1],o=e.kernelSettings,c=o.numComponents,u=o.lambda,h=o.sigma,p=o.windowSize,m=o.types,f=Object(n.useMemo)((function(){return G(p,Math.pow(2,c),u,h,m)}),[c,u,h,p,m]);return r.a.createElement("div",{style:e.style},r.a.createElement(d.a,{container:!0,spacing:4,justify:"center"},r.a.createElement(d.a,{item:!0},r.a.createElement(ae,{kernels:f,shape:pe,onUpdate:l})),r.a.createElement(d.a,{item:!0},i&&r.a.createElement(he,{kernels:f,data:i,defaultPt:me}))))},fe=a(9),ge=a(177),ve={textAlign:"center",margin:"40px 0"},ye=Object(fe.a)((function(e){return{tooltip:{backgroundColor:"#e0e0e0",maxWidth:300,fontSize:"16px",border:"1px solid #b2b2b2",color:"#000",borderRadius:0,padding:"4px"}}}))(ge.a),be=["[1] J. P. Jones and L. A. Palmer, \u201cAn evaluation of the two-dimensional Gabor filter model of simple receptive fields in cat striate cortex,\u201d Journal of neurophysiology, vol. 58, no. 6, pp. 1233\u20131258, 1987.","[2] R. Mehrotra, K. R. Namuduri, and N. Ranganathan, \u201cGabor filter-based edge detection,\u201d Pattern recognition, vol. 25, no. 12, pp. 1479\u20131494, 1992.","[3] J. Wang, Z. Zhang, C. Xie, V. Premachandran, and A. Yuille, \u201cUnsupervised learning of object semantic parts from internal states of CNNs by population encoding,\u201d arXiv:1511.06855 [cs], Nov. 2016.","[4] K. Greff, R. K. Srivastava, and J. Schmidhuber, \u201cHighway and Residual Networks learn Unrolled Iterative Estimation,\u201d arXiv:1612.07771 [cs], Mar. 2017.","[5] C. Olah, A. Mordvintsev, and L. Schubert, \u201cFeature Visualization,\u201d Distill, vol. 2, no. 11, p. e7, Nov. 2017, doi: 10.23915/distill.00007.","[6] Q. Yu, Y. Yang, F. Liu, Y.-Z. Song, T. Xiang, and T. M. Hospedales, \u201cSketch-a-net: A deep neural network that beats humans,\u201d International journal of computer vision, vol. 122, no. 3, pp. 411\u2013425, 2017.","[7] I. Shafkat, \u201cIntuitively Understanding Convolutions for Deep Learning,\u201d Medium, 07-Jun-2018. [Online]. Available: https://towardsdatascience.com/intuitively-understanding-convolutions-for-deep-learning-1f6f42faee1. [Accessed: 07-Feb-2020].","[8] E. Ulberg, \u201cVisual Concepts in Sketch-A-Net,\u201d Dec-2019. [Online]. Available: https://ulberge.github.io/SketchANetClustering/."];function we(e){var t=function(e){var t=e.map((function(e,t){return function(){return r.a.createElement(ye,{title:r.a.createElement(r.a.Fragment,null,e),interactive:!0},r.a.createElement(W.a,{style:{padding:0,minWidth:0,height:0}},r.a.createElement("span",{style:{color:"#1f7e9b"}},"[",t+1,"]")))}}));return function(e){return t[e-1]()}}(be);return r.a.createElement("div",null,r.a.createElement("p",null,r.a.createElement("i",null,"The ",r.a.createElement("b",null,"kernel tuner")," is a parametric tool that makes kernels for detecting important features in a line drawing.")),r.a.createElement("h4",null,"Example usage"),r.a.createElement("p",null,"How is the kernel tuner used?"),r.a.createElement("p",null,"Let\u2019s say I care about line drawings of boxes. First, I might draw a box in the test area. A box is made up of horizontal/vertical lines and corners at 90 degrees. So, I would select the line and corner types and limit the angles to two. This yields kernels that match the elements of a box. When applied to the drawing, the six kernels neatly label the parts of the box."),r.a.createElement("div",{style:ve},r.a.createElement("img",{src:"./imgs/tuner/scrn0.png",alt:"Kernel Tuner screenshot of making kernels",style:{height:"150px",marginRight:"20px"}}),r.a.createElement("img",{src:"./imgs/tuner/name3.png",alt:"6 Kernels",style:{height:"150px",marginRight:"20px"}}),r.a.createElement("img",{src:"./imgs/tuner/box.png",alt:"a box drawing",style:{height:"120px",marginBottom:"15px"}}),r.a.createElement("img",{src:"./imgs/tuner/names0.png",alt:"Activations (0) for box",style:{height:"100px",marginBottom:"25px"}})),r.a.createElement("p",null,"Adjusting the size of the kernels, the width of the sine wave or the radius of the 2D Gaussian changes the character of the kernels. The different kernels yield different readings of the same box."),r.a.createElement("div",{style:ve},r.a.createElement("img",{src:"./imgs/tuner/k04.png",alt:"Sample kernels with different settings",style:{height:"100px",marginRight:"20px"}}),r.a.createElement("img",{src:"./imgs/tuner/out1.png",alt:"thin output",style:{height:"75px",marginBottom:"12px"}}),r.a.createElement("img",{src:"./imgs/tuner/out2.png",alt:"med output",style:{height:"75px",marginBottom:"12px"}}),r.a.createElement("img",{src:"./imgs/tuner/out4.png",alt:"thick output",style:{height:"75px",marginBottom:"12px"}}),r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement("small",null,"(1) Different kernels that can be produced. (2) A variety of outputs."))),r.a.createElement("p",null,"The tool can also be used to check how robust the kernels are to rotation. A slider rotates the images and recalculates the activations in real time."),r.a.createElement("div",{style:ve},r.a.createElement("img",{src:"./imgs/tuner/rot.png",alt:"Kernel Tuner screenshot of rotation",style:{height:"300px"}})),r.a.createElement("p",null,"The square above is no longer well matched by the kernels generated. There are blank spaces and poorly matched labels along the lines. To help diagnose what is going wrong, the tool provides information when the user hovers over a location. On click, the tool shows a chart of the top activations at the location and what the kernels look like as overlays at that point."),r.a.createElement("div",{style:ve},r.a.createElement("img",{src:"./imgs/tuner/selection.png",alt:"Kernel Tuner screenshot of selection",style:{height:"300px"}})),r.a.createElement("p",null,"After inspection, we can see that our filters are quite relaxed. The corner is matching a corner at a different angle with high activation. We may want this, or we may want to increase the size of the Gaussian to make the filters more strict. Or, we can increase the angle setting to \u20184\u2019 to better match the corner."),r.a.createElement("div",{style:ve},r.a.createElement("img",{src:"./imgs/tuner/angles4.png",alt:"Kernel Tuner screenshot of more angles provided",style:{height:"300px"}})),r.a.createElement("h4",null,"Abstraction through convolution"),r.a.createElement("p",null,"(",r.a.createElement("i",null,"Note: A \u201ckernel\u201d is a 2D matrix of weights. A \u201cfilter\u201d is a stack of kernels, with one kernel for each input channel. Since the first layer of a black and white image has only one channel, each filter has one kernel and we can use filter and kernel interchangeably."),")"),r.a.createElement("p",null,"The kernel tuner produces kernels that translate an image from pixel values to higher order features such as lines, line ends, corners, T, X and Y-intersections. It does this through a process called convolution in which the kernels are applied as sliding windows across an image."),r.a.createElement("div",{style:ve},r.a.createElement("img",{src:"./imgs/tuner/slidingwindow.gif",alt:"sliding window animation for convolutions",style:{height:"200px"}}),r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement("small",null,"(1) The sliding window of a convolution ",t(1),"."))),r.a.createElement("p",null,"After these kernels are applied, each pixel location is given a more meaningful name like \u201cvertical line\u201d or \u201cT-intersection at 45 degrees.\u201d In reality, they are being given values corresponding to each name, but we can think of the channel with the highest value as the locations assigned name."),r.a.createElement("div",{style:ve},r.a.createElement("img",{src:"./imgs/tuner/name2.png",alt:"line drawing of a box",style:{height:"40px",marginBottom:"80px",marginRight:"40px"}}),r.a.createElement("img",{src:"./imgs/tuner/name3.png",alt:"6 kernels for a box line drawing",style:{height:"200px",marginRight:"40px"}}),r.a.createElement("img",{src:"./imgs/tuner/name0.png",alt:"graphics of max activations for a box line drawing",style:{height:"200px"}}),r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement("small",null,"(1) Raw pixel data. (2) Set of kernels. (3) Map of maximum activations."))),r.a.createElement("p",null,"By extracting this information, we can interact with the canvas at a higher level of abstraction. Convolutional neural networks use this process to classify images as abstract entities. The prevailing wisdom is that each layer of a network produces a higher order of information than the previous layer ",t(5),". This may or may not be the case, but it is at least a useful starting point for thinking about how networks learn ",t(4),"."),r.a.createElement("p",null,"At the first layer, filters function as templates. They may be fuzzy, but they match a narrow range of pixel arrangements. After multiple layers the filters no longer correspond to templates. The network can match a visual object at different scales, rotations, or individual expressions (to some extent). It should be noted that if something can be matched with a template, it only requires one layer of convolution. If an object is abstract (i.e. it can take a variety of forms), then the network must flexibly encode the visual concept through multiple layers."),r.a.createElement("div",{style:ve},r.a.createElement("img",{src:"./imgs/tuner/match2.png",alt:"line drawing of a corner",style:{height:"80px"}}),r.a.createElement("img",{src:"./imgs/tuner/match0.png",alt:"6 kernel overlays of corner line drawing",style:{height:"80px"}}),r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement("small",null,"(1) Kernels overlaid on corner."))),r.a.createElement("h4",null,"Background"),r.a.createElement("p",null,"The patterns for the kernels produced by this tool are inspired by Gabor filters. Gabor filters are kernels created using a 2D Gaussian function applied to a sine wave ",t(2),". They are useful for edge detection (or in this case, line detection). A study by Jones and Palmer demonstrated that 2D Gabor filters provide similar performance to the simple receptive fields in a mammalian visual cortex ",t(1),". As further demonstration of their representational capacity, a convolutional neural network trained on a dataset of line drawings learned filters that looked eerily similar to Gabor filters ",t(6),".)"),r.a.createElement("div",{style:ve},r.a.createElement("img",{src:"./imgs/tuner/func0.png",alt:"1D Gabor filter",style:{height:"100px",marginRight:"20px"}}),r.a.createElement("img",{src:"./imgs/tuner/gaborplus2.jpg",alt:"kernels in Sketch-A-Net",style:{height:"100px",marginRight:"20px"}}),r.a.createElement("img",{src:"./imgs/tuner/gaborplus.jpg",alt:"Gabor filters",style:{height:"100px"}}),r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement("small",null,"(1) 1D Gabor filter. Red: sine wave, Green: 1D Gaussian (also known as a normal distribution), Blue: Gabor filter. (2) A bank of Gabor filters at different sizes and rotations ",t(6),". (3) Kernels from the first layer of Sketch-A-Net ",t(6),"."))),r.a.createElement("h4",null,"Construction of kernels"),r.a.createElement("p",null,"Typically, Gabor filters are applied at various sizes (as seen in the bank above). This tool is designed to work with line drawings of a consistent stroke width and therefore provides a single size. In addition, this tool produces filters that are cut off after a single traversal of a sine wave. Gabor filters have multiple ridges to match textures in addition to lines."),r.a.createElement("p",null,"(For simplicity's sake, this project ignores textures and focuses on detecting line features. Even though textures play an important role in some styles of line drawings.)"),r.a.createElement("div",{style:ve},r.a.createElement("img",{src:"./imgs/tuner/gaborme.png",alt:"vertical line filter generated with tuner",style:{height:"150px"}}),r.a.createElement("img",{src:"./imgs/tuner/gabor1.jpg",alt:"vertical Gabor filter",style:{height:"150px",marginLeft:"20px"}}),r.a.createElement("img",{src:"./imgs/tuner/kerneltypes.png",alt:"sample of line filters generated with tuner",style:{height:"100px",marginBottom:"25px",marginLeft:"20px"}}),r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement("small",null,"(1) Vertical line filter generated with Kernel Tuner. (2) Vertical Gabor filter. (3) Other types of kernels generated."))),r.a.createElement("p",null,"The other important difference is the range of features matched. Instead of being limited to lines of different orientations, the kernels produced can match a range of feature types. Normally, networks take their time to build up these representations. In an investigation of the representations at different layers within Sketch-a-Net (which has convolutional layers), I found that the first layer matched line orientations ",t(8),". Layers two through four haphazardly refined features such as corners, rounded corners, dots, curves, and a variety of textures. "),r.a.createElement("div",{style:ve},r.a.createElement("img",{src:"./imgs/tuner/viz0.png",alt:"Sketch-A-Net layer 1 visual concepts",style:{maxWidth:"500px",width:"70%"}}),r.a.createElement("img",{src:"./imgs/tuner/viz1.png",alt:"Sketch-A-Net layer 2 visual concepts",style:{maxWidth:"500px",width:"70%"}}),r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement("small",null,"(1-4) Illustrations of visual concepts in Layers 1 and 2 in Sketch-A-Net, found using a K-Means clustering approach borrowed from ",t(3),". More can be seen ",r.a.createElement("a",{href:"https://ulberge.github.io/SketchANetClustering/"},"here")))),r.a.createElement("p",null,"While the machine derives representations it finds useful from scratch, a human can define the important features of a line drawing logically. Namely, we know we care about the orientation of the lines and their intersections. We could define other features of interest, but the number of filters could quickly get out of control. The approach of this tuner is to incorporate human common sense while leaving further features to be derived later on."),r.a.createElement("p",null,"The kernel types were chosen to span the range of possibilities for one, two, or three lines that pass from outside the kernel window through (or to) the center of the kernel window. Typically CNNs learn to detect features at different offsets as well, but I chose to ignore that until I can be convinced it is necessary. The goal is to efficiently extract the most salient, \u201ctemplate\u201d-like information available. Subsequent layers will condense and make sense of it."),r.a.createElement("p",null,"The construction of these kernels is similar to Gabor filters but with a domain limited to PI. Furthermore, each kernel is a Frankenstein of Gabor filters corresponding to the lines involved. Most are composed of multiple lines stitched together."),r.a.createElement("div",{style:ve},r.a.createElement("img",{src:"./imgs/tuner/linetypes.png",alt:"The one, two, and three line constructions considered",style:{height:"200px",filter:"grayscale()"}}),r.a.createElement("img",{src:"./imgs/tuner/stitch.png",alt:"The \u2018L\u2019 corner is made by stitching perpendicular Gabor filters along a diagonal a 45 degree angle",style:{height:"100px",marginBottom:"50px",marginLeft:"40px"}}),r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement("small",null,"(1) The one, two, and three line constructions considered. (2) The \u2018L\u2019 corner is made by stitching together Gabor filters."))),r.a.createElement("h4",null,"Head-to-head comparison with first layer kernels in machine learning"),r.a.createElement("p",null,"To verify that these kernels encode sufficient information to act as a foundation for robust networks, I built models on top of them. Then, I compared the classification accuracy with other approaches. I tested models with the kernels as the fixed, pre-trained weights and compared them with models using random, trainable weights. For this experiment, I used the TU Berlin sketch dataset, augmented through shifting the images and through slight shear, zoom, and rotational transformations. I also compare the results to state-of-the-art approaches."),r.a.createElement("h4",null,"Test #1"),r.a.createElement("p",null,"The first network I built was designed to classify using simple statistics built on top of the Kernel Tuner filters. My hope was to establish a baseline of how much information was being extracted through just the kernels. The network pools the information and uses a fully connected layer before the final softmax layer to calculate statistics."),r.a.createElement("div",{style:ve},r.a.createElement("img",{src:"./imgs/tuner/stats.png",alt:"Model summary for Test #1 of stats on top of kernels",style:{height:"300px"}}),r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement("small",null,"(1) Model summary for Test #1 of statistics on top of kernels."))),r.a.createElement("h4",null,"Test #2"),r.a.createElement("p",null,"Secondly, I built a shallow CNN on top of the kernels to see how they would compare to a network without pretrained weights and to state of the art results on the same dataset. While this network has over 3 million trainable weights, it is still considerably smaller than the 8.5 million of Sketch-A-Net ",t(6)),r.a.createElement("div",{style:ve},r.a.createElement("img",{src:"./imgs/tuner/conv.png",alt:"Model summary for Test #2 of shallow CNN on top of kernels",style:{height:"500px"}}),r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement("small",null,"(1) Model summary for Test #2 of shallow CNN on top of kernels."))),r.a.createElement("h4",null,"Results"),r.a.createElement("p",null,"My preliminary results show a % for the shallow statistical network and % for the shallow CNN. When I replaced the kernels with random weights the results were % and % respectively. Sketch-A-Net achieved %, although with more weights and a more complex model. I would argue that the use of kernels also improved the generalizability since there was a concerted approach to have a well distributed set of features recognized."),r.a.createElement("h4",null,"Conclusion"),r.a.createElement("p",null,"The kernel tuner provides a way to tune kernels for line drawings. It acts as a visual debugger to make the filters for the first convolutional layer to translate from pixels to visual concepts."))}function xe(e){return r.a.createElement(f.a,{defaultExpanded:!0,TransitionProps:{mountOnEnter:!0},square:!0,style:{boxShadow:"none",border:"1px solid #b2b2b2"}},r.a.createElement(g.a,{expandIcon:r.a.createElement(b.a,null),"aria-controls":"kerneltuner-content"},r.a.createElement("h3",{style:{margin:"0 10px"}},"About")),r.a.createElement(v.a,{style:{margin:"0px 20px"}},r.a.createElement(we,null)))}var ke=a(175);var Ee=function(e){var t=e.kernelSettings,a=e.updateKernelSettings;return r.a.createElement("div",null,r.a.createElement("h2",null,"Kernel Tuner"),r.a.createElement(ke.a,{maxWidth:"md"},r.a.createElement(L,{defaultKernelSettings:t,updateKernelSettings:a})),r.a.createElement(ke.a,{maxWidth:"lg",style:{marginTop:"40px"}},r.a.createElement(de,{kernelSettings:t})),r.a.createElement(ke.a,{maxWidth:"md",style:{marginTop:"40px"}},r.a.createElement("hr",{style:{border:0,borderTop:"1px solid #b2b2b2"}}),r.a.createElement(xe,null)))},_e=Object(o.a)({palette:{primary:h.a}}),Me={numComponents:2,lambda:4.9,sigma:3.3,windowSize:9,types:[I[0],I[2]]};var Oe="kernelSettings",je=JSON.parse(localStorage.getItem(Oe)),Se=function(e){if(!e)return!1;var t=e.numComponents,a=e.lambda,n=e.sigma,r=e.windowSize,i=e.types;if(isNaN(t)||isNaN(a)||isNaN(n)||isNaN(r))return!1;if(!Array.isArray(i)||0===i.length)return!1;var l=!0,s=!1,o=void 0;try{for(var c,u=i[Symbol.iterator]();!(l=(c=u.next()).done);l=!0){var h=c.value;if(!I.includes(h))return!1}}catch(p){s=!0,o=p}finally{try{l||null==u.return||u.return()}finally{if(s)throw o}}return!0}(je)?je:Me;l.a.render(r.a.createElement((function(){var e=Object(n.useState)(Se),t=Object(s.a)(e,2),a=t[0],i=t[1];return Object(n.useEffect)((function(){localStorage.setItem(Oe,JSON.stringify(a))}),[a]),r.a.createElement(c.a,{theme:_e},r.a.createElement(Ee,{kernelSettings:a,updateKernelSettings:i}))}),null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[102,1,2]]]);
//# sourceMappingURL=main.811e148b.chunk.js.map