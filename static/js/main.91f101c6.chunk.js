(this["webpackJsonpinteractive-network"]=this["webpackJsonpinteractive-network"]||[]).push([[0],{133:function(t,e){},134:function(t,e){},135:function(t,e){},136:function(t,e){},137:function(t,e){},138:function(t,e){},139:function(t,e,a){"use strict";a.r(e);var n=a(1),r=a.n(n),i=a(21),l=a.n(i);a(99),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var o=a(6),s=a(82),u=a(167),c=a(81),h=a.n(c),p=a(14),f=a(45),d=a(161),m=a(168),v=a(171),y=a(164),g=a(80),b=a.n(g),x=a(22),_=a.n(x),k=a(5);var w=function(t){var e=t.imgArr,a=t.scale,i=Object(n.useRef)(null),l=Object(n.useRef)(null);return Object(n.useEffect)((function(){l.current||(l.current=new _.a((function(t){t._draw=function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(e)if(t._setupDone){var n=e.length,r=e[0].length;n===t.height&&r===t.width||t.resizeCanvas(r,n),t.canvas.style.height=n*a+"px",t.canvas.style.width=r*a+"px",t.clear();var i=e.flat(),l=Math.max.apply(Math,Object(k.a)(i));l=l>0?l:-Math.min.apply(Math,Object(k.a)(i)),e=e.map((function(t){return t.map((function(t){return t/l}))})),t.loadPixels();for(var o=0;o<e.length;o+=1)for(var s=0;s<e[0].length;s+=1){var u=255*e[o][s];u>=0?t.set(s,o,t.color(0,0,0,u)):u<0&&t.set(s,o,t.color(214,30,30,.75*-u))}t.updatePixels()}else setTimeout((function(){return t._draw(e,a)}),10)},t.setup=function(){t.pixelDensity(1),t.createCanvas(1,1),t.stroke(255),t.noLoop(),t.noSmooth()}}),i.current)),l.current&&l.current._draw(e,a)}),[e,a]),r.a.createElement("div",{ref:i})},M=function(t){var e=t.imgArrs,a=t.cols,n=t.scale;return r.a.createElement(d.a,{container:!0,spacing:1,style:t.style},e.map((function(t,e){return r.a.createElement(d.a,{item:!0,key:e,style:a&&e%a===a-1?{breakAfter:"always"}:{}},r.a.createElement(w,{imgArr:t,scale:n}))})))},O=a(170),j=a(163),E=a(169),S=a(9),C=a.n(S),B=["I","i","L","T","X","Y",">","_/",")","\u2b51"];function z(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return function(n,r){var i=2*Math.PI/e*(n*Math.cos(t)+r*Math.sin(t));return i>Math.PI*a||i<-Math.PI*a?null:Math.cos(i)}}function I(t){return function(e,a){return Math.exp(-.5*(Math.pow(e,2)/Math.pow(t,2)+Math.pow(a,2)/Math.pow(t,2)))}}function P(t,e,a,n){for(var r=z(e,a),i=I(n),l=C.a.zeros([t,t]).assign(-1,!1).tolist(),o=Math.floor(t/2),s=0;s<t;s+=1)for(var u=s-o,c=0;c<t;c+=1){var h=c-o,p=r(h,u);null!==p&&(l[s][c]=p),l[s][c]=l[s][c]*i(h,u)}return l}function A(t,e,a,n){for(var r=z(e,a),i=I(n),l=C.a.zeros([t,t]).assign(-1,!1).tolist(),o=Math.floor(t/2),s=0;s<t;s+=1)for(var u=s-o,c=0;c<t;c+=1){var h=c-o,p=null,f=Math.sin(e)*h-Math.cos(e)*u;f<1e-5?p=r(h,u):f<1.00001&&(p=(p=r(h,u))>0?p/2:p),null!==p&&(l[s][c]=p),l[s][c]=l[s][c]*i(h,u)}return l}function D(t,e,a,n,r){for(var i=2*Math.PI/a,l=Math.floor(t/2),o=[],s=0;s<a;s+=1){for(var u=s*i,c=Math.sin(u+Math.PI/2-e/2),h=Math.cos(u+Math.PI/2-e/2),p=A(t,u,n,r),f=A(t,u-e,n,r),d=C.a.zeros([t,t]).tolist(),m=0;m<t;m+=1)for(var v=m-l,y=0;y<t;y+=1){var g=c*(y-l)-h*v;d[m][y]=g<1e-5?p[m][y]:f[m][y]}o.push(d)}return o}function T(t,e,a){for(var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=I(a),i=I(n*e/4),l=C.a.zeros([t,t]).assign(-1,!1).tolist(),o=Math.floor(t/2),s=0;s<t;s+=1)for(var u=s-o,c=0;c<t;c+=1){var h=c-o;l[s][c]=8*i(h,u)-r(h,u)}var p=Math.max.apply(Math,Object(k.a)(l.flat()));return l.map((function(t){return t.map((function(t){return t/p}))}))}function R(t){var e,a=0,n=0,r=0;t.forEach((function(t){return t.forEach((function(t){t>0?(a+=t,t>n&&(n=t)):t<r&&(r=t)}))})),e=0===n||0===r?1:-r/(n/a);var i=a;return t=t.map((function(t){return t.map((function(t){return t>0?t/i:t/e}))}))}function L(t,e,a,n,r){var i=[];if(!t||!e)return i;r.includes(B[0])&&i.push.apply(i,Object(k.a)(function(t,e,a,n){for(var r=Math.PI/e,i=[],l=0;l<e;l+=1){var o=P(t,l*r,a,n);i.push(o)}return i}(t,e,a,n))),r.includes(B[1])&&i.push.apply(i,Object(k.a)(function(t,e,a,n){for(var r=2*Math.PI/e,i=[],l=0;l<e;l+=1){var o=A(t,l*r,a,n);i.push(o)}return i}(t,e,a,n))),r.includes(B[2])&&i.push.apply(i,Object(k.a)(D(t,.5*Math.PI,e,a,n))),r.includes(B[3])&&i.push.apply(i,Object(k.a)(function(t,e,a,n,r){for(var i=2*Math.PI/a,l=Math.floor(t/2),o=[],s=0;s<a;s+=1){for(var u=s*i,c=Math.sin(u+Math.PI/2),h=Math.cos(u+Math.PI/2),p=P(t,u,n,r),f=A(t,u-e,n,r),d=C.a.zeros([t,t]).tolist(),m=0;m<t;m+=1)for(var v=m-l,y=0;y<t;y+=1){if(c*(y-l)-h*v<1e-5)d[m][y]=p[m][y];else{var g=Math.max(p[m][y],f[m][y]),b=Math.min(p[m][y],f[m][y]);d[m][y]=g>0?g:b}}o.push(d)}return o}(t,.5*Math.PI,e,a,n))),r.includes(B[4])&&i.push.apply(i,Object(k.a)(function(t,e,a,n,r){for(var i=Math.PI/2/a,l=[],o=0;o<a;o+=1){for(var s=o*i,u=P(t,s,n,r),c=P(t,s-e,n,r),h=C.a.zeros([t,t]).tolist(),p=0;p<t;p+=1)for(var f=0;f<t;f+=1){var d=Math.max(u[p][f],c[p][f]),m=Math.min(u[p][f],c[p][f]);h[p][f]=d>0?d:m}l.push(h)}return l}(t,.5*Math.PI,e/2,a,n))),r.includes(B[5])&&i.push.apply(i,Object(k.a)(function(t,e,a,n,r){for(var i=2*Math.PI/a,l=Math.floor(t/2),o=[],s=0;s<a;s+=1){for(var u=s*i,c=A(t,u,n,r),h=A(t,u-Math.PI+e,n,r),p=A(t,u-Math.PI-e,n,r),f=Math.sin(u),d=Math.cos(u),m=C.a.zeros([t,t]).tolist(),v=0;v<t;v+=1)for(var y=v-l,g=0;g<t;g+=1){if(f*(g-l)-d*y<-1.00001)m[v][g]=c[v][g];else{var b=Math.max(h[v][g],p[v][g],c[v][g]),x=Math.min(h[v][g],p[v][g],c[v][g]);m[v][g]=b>0?b:x}}o.push(m)}return o}(t,.25*Math.PI,e,a,n))),r.includes(B[6])&&i.push.apply(i,Object(k.a)(D(t,.25*Math.PI,e,a,n))),r.includes(B[7])&&i.push.apply(i,Object(k.a)(D(t,.75*Math.PI,e,a,n))),r.includes(B[8])&&i.push.apply(i,Object(k.a)(D(t,.925*Math.PI,2*e,a,n))),r.includes(B[9])&&(i.push(T(t,a,n,.7)),i.push(T(t,a,n,1)));var l=i.map(R);return r.includes(B[9]),console.log(l.map((function(t){return t.map((function(t){return t.join(",")})).join("\n")})).join("\n:\n")),l}var N=Object(n.memo)((function(t){return r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement("div",null,"Types"),r.a.createElement(E.a,{value:t.types,onChange:function(e,a){return a.length>0?t.onChange("types",a):0},"aria-label":"types of kernels",style:{borderRadius:0,margin:"12px 0 0 0"},className:"toggle-types"},B.slice(0,5).map((function(t,e){return r.a.createElement(j.a,{key:t,value:t,style:{borderRadius:0,height:"28px",width:"28px",textTransform:"none",padding:"4px",textAlign:"center"}},t)}))),r.a.createElement(E.a,{value:t.types,onChange:function(e,a){return a.length>0?t.onChange("types",a):0},"aria-label":"types of kernels",style:{borderRadius:0,margin:"2px 0 12px 0"},className:"toggle-types"},B.slice(5,10).map((function(t,e){return r.a.createElement(j.a,{key:t,value:t,style:{borderRadius:0,height:"28px",width:"28px",textTransform:"none",padding:"4px",textAlign:"center"}},t)})))),r.a.createElement("div",null,r.a.createElement("div",null,"Angles"),r.a.createElement(O.a,{defaultValue:t.numComponents,track:!1,"aria-labelledby":"number of components",marks:[1,2,3,4,5].map((function(t){return{value:t,label:Math.pow(2,t)}})),step:1,min:1,max:5,onChange:function(e,a){return t.onChange("numComponents",a)}})),r.a.createElement("div",null,r.a.createElement("div",null,"Size"),r.a.createElement(O.a,{defaultValue:t.windowSize,track:!1,"aria-labelledby":"window size",valueLabelDisplay:"auto",marks:[3,5,7,9,11,13,15].map((function(t){return{value:t,label:t}})),step:2,min:3,max:15,onChange:function(e,a){return t.onChange("windowSize",a)}})),r.a.createElement("div",null,r.a.createElement("div",null,"Width Factor"),r.a.createElement(O.a,{defaultValue:t.lambda,track:!1,"aria-labelledby":"lambda",valueLabelDisplay:"auto",step:.1,min:1.1,max:10,onChange:function(e,a){return t.onChange("lambda",a)},style:{padding:"24px 0"}})),r.a.createElement("div",null,r.a.createElement("div",null,"Gaussian Spread"),r.a.createElement(O.a,{defaultValue:t.sigma,track:!1,"aria-labelledby":"sigma",valueLabelDisplay:"auto",step:.1,min:.1,max:8,onChange:function(e,a){return t.onChange("sigma",a)},style:{padding:"24px 0"}})))}));var F=function(t){var e=t.defaultKernelSettings,a=t.updateKernelSettings,i=Object(n.useState)(e),l=Object(o.a)(i,2),s=l[0],u=l[1],c=s.numComponents,h=s.lambda,g=s.sigma,x=s.windowSize,_=s.types,k=Object(n.useRef)(null),w=Object(n.useCallback)((function(t,e){var n=Object(f.a)({},s,Object(p.a)({},t,e));u(n),k.current&&clearTimeout(k.current),k.current=setTimeout((function(){a(n)}),100)}),[u,s,a]),O=Object(n.useMemo)((function(){return L(x,Math.pow(2,c),h,g,_)}),[c,h,g,x,_]);return r.a.createElement(m.a,{defaultExpanded:!0,square:!0,style:{boxShadow:"none",border:"1px solid #b2b2b2"}},r.a.createElement(v.a,{expandIcon:r.a.createElement(b.a,null),"aria-controls":"kerneltuner-content"},r.a.createElement("h3",{style:{margin:"0 10px"}},"Kernel Maker")),r.a.createElement(y.a,{style:{margin:"10px 20px"}},r.a.createElement(d.a,{container:!0,justify:"flex-start",spacing:4},r.a.createElement(d.a,{item:!0,style:{marginRight:"20px",width:"165px"}},r.a.createElement(N,{numComponents:c,lambda:h,sigma:g,windowSize:x,types:_,onChange:w})),r.a.createElement(d.a,{item:!0,style:{width:"calc(100% - 220px)"}},r.a.createElement(M,{imgArrs:O,scale:4,cols:10})))))},W=a(165),K=a(61),G=Object(n.memo)((function(t){var e=Object(n.useState)(t.defaultValue),a=Object(o.a)(e,2),i=a[0],l=a[1],s=Object(n.useCallback)(Object(K.debounce)(t.onChange,t.timer||0),[t]);return r.a.createElement(O.a,Object.assign({value:i},t,{onChange:function(t,e){l(e),s(t,e)}}))})),V=a(18),U=a(15),X=a(7),Y="float32",J=function(){function t(e,a,n,r){var i,l=this;Object(V.a)(this,t),this._shape=a,this._stride=r,this._pad=Math.floor(n/2),0!==this._pad?(i=this._shape.map((function(t){return t+2*l._pad})),this._outerBounds=[-this._pad,-this._pad,this._shape[1]+this._pad,this._shape[0]+this._pad]):(i=a.map((function(t){return Math.ceil(t/l._stride)*l._stride})),this._outerBounds=[0,0,i[1],i[0]]);var s=i,u=Object(o.a)(s,2),c=u[0],h=u[1];this._channels=e,this._arr=C.a.zeros([e,c,h],Y),this._ids=C.a.zeros(this._shape,"int32").assign(-1,!1),this._max=C.a.zeros(this._shape,Y),this._dirtyBounds=null}return Object(U.a)(t,[{key:"assign",value:function(t,e,a){null===e?this._slice(a).assign(t,!1):this._slice(a).slice([e,e+1],null,null).assign(t,!1),this._updateDirtyBounds(a)}},{key:"clean",value:function(){this._dirtyBounds=null}},{key:"calcStats",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"cpu";if(this._dirtyBounds){var a,n;e&&(n=X.b());var r,i=Object(o.a)(this._dirtyBounds,4),l=i[0],s=i[1],u=i[2],c=i[3],h=c-s,p=u-l,f=[],d=Date.now();e&&X.g(e),f.push(X.b());var m=t.argMax(1);e&&X.g(n),r=Date.now(),f.push("argmax -> "),f.push(r-d),d=r,f.push(X.b());var v=m.dataSync();r=Date.now(),f.push("data sync -> "),f.push(r-d),d=r,f.push(X.b());var y=C.a.int32(v);y=y.reshape([h,p]);var g=this._ids.slice([s,c],[l,u]);g.assign(y,!1),r=Date.now(),f.push("update _ids -> "),f.push(r-d),d=r,f.push(X.b());var b=t.reshape([-1]),x=m.reshape([-1]),_=X.d(x,X.f(p*h,"int32")),k=X.e(0,h*p,1,"int32"),w=X.a(_,k);r=Date.now(),f.push("prepare gather -> "),f.push(r-d),d=r,e&&X.g(e),f.push(X.b());var M=b.gather(w);e&&X.g(n),r=Date.now(),f.push("gather -> "),f.push(r-d),d=r,f.push(X.b());var O=C.a[Y](M.dataSync()).reshape([h,p]),j=this._max.slice([s,c],[l,u]);j.assign(O,!1),r=Date.now(),f.push("update _max -> "),f.push(r-d),d=r,(a=console).log.apply(a,["calc stats:",e,"total time -> ",f.reduce((function(t,e){return Number.isInteger(e)?t+e:t}),0)].concat(f))}}},{key:"_slice",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t||(t=[0,0].concat(Object(k.a)(this._shape)));var e=t,a=Object(o.a)(e,4),n=a[0],r=a[1],i=a[2],l=a[3];return this._arr.slice(null,[r+this._pad,l+this._pad],[n+this._pad,i+this._pad])}},{key:"_updateDirtyBounds",value:function(t){if(this._dirtyBounds){var e=Object(o.a)(t,4),a=e[0],n=e[1],r=e[2],i=e[3],l=Object(o.a)(this._dirtyBounds,4),s=l[0],u=l[1],c=l[2],h=l[3];this._dirtyBounds=[Math.min(a,s),Math.min(n,u),Math.max(r,c),Math.max(i,h)]}else this._dirtyBounds=t}},{key:"print",value:function(){this.arr.tolist().forEach((function(t){return console.table(t)}))}},{key:"printBacking",value:function(){this._arr.tolist().forEach((function(t){return console.table(t)}))}},{key:"dirty",get:function(){return this._dirtyBounds?this._slice(this.dirtyBounds):null}},{key:"dirtyBounds",get:function(){var t=this;if(!this._dirtyBounds)return null;var e=this._dirtyBounds;if(0!==this._pad&&(e=function(t,e){if(!t||!e)return t;var a=Object(o.a)(t,4),n=a[0],r=a[1],i=a[2],l=a[3],s=Object(o.a)(e,4),u=s[0],c=s[1],h=s[2],p=s[3],f=Math.max(n,u),d=Math.max(r,c),m=Math.min(i,h),v=Math.min(l,p);return[f,d,m,v]}(e=H(this._dirtyBounds,2*this._pad),this._outerBounds)),1!==this._stride){var a=e=e.map((function(e){return e/t._stride})),n=Object(o.a)(a,4),r=n[0],i=n[1],l=n[2],s=n[3];e=(e=[Math.floor(r),Math.floor(i),Math.ceil(l),Math.ceil(s)]).map((function(e){return e*t._stride}))}return e}},{key:"arr",get:function(){return this._slice([0,0,this._shape[1],this._shape[0]])}}],[{key:"pool",value:function(e,a,n){return new t(e,a,0,n)}},{key:"conv",value:function(e,a,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return new t(e,a,n,r)}}]),t}();function H(t,e){if(!t||0===t.length||!e)return t;var a=Object(o.a)(t,4);return[a[0]-e,a[1]-e,a[2]+e,a[3]+e]}var q=function(){function t(e,a,n,r){Object(V.a)(this,t),this.input=e,this.output=a,this._kernelSize=r,this._pad=Math.floor(r/2),this._rawFilters=n,this.filters=n.map((function(t){return t.map((function(t){return t?C.a[Y]([t]):null}))})),this._tflayer=function(t,e){var a=t.shape[0],n=t.transpose(2,3,1,0).tolist(),r=C.a.zeros([a]).tolist();t.tolist().forEach((function(t,e){0===t.flat().flat().filter((function(t){return t>0})).length&&(r[e]=64)}));var i=[X.i(n),X.h(r)];return X.c.conv2d({filters:a,kernelSize:e,strides:1,padding:"valid",weights:i,activation:"relu",dataFormat:"channelsFirst"})}(C.a[Y](n.map((function(t){return t.map((function(t){return t||C.a.zeros([r,r],Y).tolist()}))}))),r)}return Object(U.a)(t,[{key:"runWith",value:function(t){var e,a,n,r=this.input.dirty,i=[],l=Date.now(),o=r.reshape([1].concat(Object(k.a)(r.shape))).selection,s=X.i(o.data,o.shape);a=Date.now(),i.push("to tensor -> "),i.push(a-l),l=a,t&&(n=X.b(),X.g(t)),i.push(X.b());var u=this._tflayer.apply(s);t&&X.g(n),a=Date.now(),i.push("apply conv -> "),i.push(a-l),l=a,i.push(X.b());var c=u.dataSync();a=Date.now(),i.push("data sync -> "),i.push(a-l),l=a,i.push(X.b());var h=C.a[Y](c);return a=Date.now(),i.push("to array -> "),i.push(a-l),l=a,(e=console).log.apply(e,["conv stats:",t,"total time -> ",i.reduce((function(t,e){return Number.isInteger(e)?t+e:t}),0)].concat(i)),{output:u,updateArr:h}}},{key:"run",value:function(){var t=H(this.input.dirtyBounds,-this._pad),e=Object(o.a)(t,4),a=e[0],n=e[1],r=e[2],i=e[3]-n,l=r-a,s=i*l*this._kernelSize*this._rawFilters.length;X.g("cpu");var u,c=i*l>=22500||s>8e6,h="".concat(l," x ").concat(i," x ").concat(this._kernelSize," x ").concat(this._rawFilters.length," = ").concat(s);c?(console.log("dirty size x kernel x kernels -> ",h," -> electing webgl backend"),u=this.runWith("webgl")):(console.log("dirty size x kernel x kernels -> ",h," -> electing cpu backend"),u=this.runWith("cpu"));var p=u,f=p.output,d=p.updateArr,m=[this.output._channels,i,l],v=d.reshape(m);this.output.assign(v,null,t),c?this.output.calcStats(f,"webgl"):this.output.calcStats(f,"cpu"),this.input.clean()}}]),t}();var $=function(){function t(e,a,n){Object(V.a)(this,t),this.input=e,this.output=a,this.poolSize=n,this._tflayer=X.c.maxPooling2d({poolSize:n,dataFormat:"channelsFirst"})}return Object(U.a)(t,[{key:"run",value:function(){var t=this,e=this.input.dirty,a=this.input.dirtyBounds.map((function(e){return Math.ceil(e/t.poolSize)})),n=Object(o.a)(a,4),r=n[0],i=n[1],l=n[2],s=n[3]-i,u=l-r,c=s*u;c>3e3?(X.g("webgl"),console.log("opting to use webgl")):X.g("cpu");var h=e.reshape([1].concat(Object(k.a)(e.shape))).selection,p=X.i(h.data,h.shape),f=this._tflayer.apply(p),d=[this.output._channels,s,u],m=C.a[Y](f.dataSync()).reshape(d);X.g("cpu"),this.output.assign(m,null,a),c>3e3?this.output.calcStats(f,"webgl"):this.output.calcStats(f,"cpu"),this.input.clean()}}]),t}(),Q=function(){function t(e,a){var n=this;Object(V.a)(this,t),this.layerInfos=a,this.arrs=[];var r=1,i=e,l=!0,s=!1,u=void 0;try{for(var c,h=function(){var t=c.value,e=void 0;"conv2d"===t.type?(e=J.conv(r,i,t.kernelSize),r=t.filters.length):"maxPool2d"===t.type&&(e=J.pool(r,i,t.poolSize),i=i.map((function(e){return Math.ceil(e/t.poolSize)}))),n.arrs.push(e)},p=a[Symbol.iterator]();!(l=(c=p.next()).done);l=!0)h()}catch(O){s=!0,u=O}finally{try{l||null==p.return||p.return()}finally{if(s)throw u}}this.arrs.push(J.conv(r,i,0)),this.layers=[];var f=!0,d=!1,m=void 0;try{for(var v,y=a.entries()[Symbol.iterator]();!(f=(v=y.next()).done);f=!0){var g=v.value,b=Object(o.a)(g,2),x=b[0],_=b[1],k=this.arrs[x],w=this.arrs[x+1],M=void 0;"conv2d"===_.type?M=new q(k,w,_.filters,_.kernelSize):"maxPool2d"===_.type&&(M=new $(k,w,_.poolSize)),this.layers.push(M)}}catch(O){d=!0,m=O}finally{try{f||null==y.return||y.return()}finally{if(d)throw m}}}return Object(U.a)(t,[{key:"run",value:function(t,e){this.arrs[0].assign(t,0,e);var a=Date.now(),n=!0,r=!1,i=void 0;try{for(var l,s=this.layers.entries()[Symbol.iterator]();!(n=(l=s.next()).done);n=!0){var u=l.value,c=Object(o.a)(u,2),h=c[0],p=c[1],f=Date.now();p.run();var d=Date.now();console.log("time for layer "+h,d-f)}}catch(v){r=!0,i=v}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}var m=Date.now();console.log("total network time",m-a),this.arrs[this.arrs.length-1].clean()}},{key:"getOutput",value:function(t){var e=this.arrs[t+1];return{acts:e.arr,max:e._max,ids:e._ids}}}]),t}();function Z(t,e,a){return t<e?e:t>=a?a-.001:t}function tt(t,e){var a=Object(o.a)(e,4),n=a[0],r=a[1],i=a[2],l=a[3],s=Z(t.x,n,i),u=Z(t.y,r,l);return new _.a.Vector(s,u)}var et=function(){function t(e,a,n){Object(V.a)(this,t),this.p=e,this.shape=a,this.layerInfos=n,this.network=new Q(this.shape,n),this._dirtyBounds=null,this._backup=null,this._listeners=[]}return Object(U.a)(t,[{key:"init",value:function(){var t=this;this.p._setupDone?this.forceFullUpdate():setTimeout((function(){return t.init()}),10)}},{key:"reset",value:function(){this.p.clear(),this.forceFullUpdate()}},{key:"addSegment",value:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t=tt(t,this.bounds),e=tt(e,this.bounds);var n,r=this._getLineBounds(t,e);a&&(null!==this._backup&&console.log("Overwriting existing backup! Should call restore() first"),this._backup={img:(n=this.p).get.apply(n,Object(k.a)(r)),bounds:r});this.p.line(t.x,t.y,e.x,e.y),this._updateDirtyBounds(r)}},{key:"restore",value:function(){if(null!==this._backup){var t=this._backup,e=t.img,a=t.bounds,n=a.slice(0,2),r=Object(o.a)(n,2),i=r[0],l=r[1];this.p.image(e,i,l),this._backup=null,this._updateDirtyBounds(a)}else console.log("Backup failed, no backup cache available")}},{key:"update",value:function(){if(this._dirtyBounds){var t=Object(o.a)(this._dirtyBounds,4),e=t[0],a=t[1],n=t[2],r=t[3],i=this.p.get(e,a,n-e,r-a);i.loadPixels();var l=C.a[Y](i.pixels).reshape(i.height,i.width,4).slice(null,null,[3,4]).reshape(1,i.height,i.width);this.network.run(l,this._dirtyBounds),this._notifyListeners({network:this.network,dirtyBounds:Object(k.a)(this._dirtyBounds)}),this._dirtyBounds=null}}},{key:"forceFullUpdate",value:function(){this._dirtyBounds=this.bounds,this.update()}},{key:"_updateDirtyBounds",value:function(t){if(this._dirtyBounds){var e=Object(o.a)(t,4),a=e[0],n=e[1],r=e[2],i=e[3],l=Object(o.a)(this._dirtyBounds,4),s=l[0],u=l[1],c=l[2],h=l[3];this._dirtyBounds=[Math.min(a,s),Math.min(n,u),Math.max(r,c),Math.max(i,h)]}else this._dirtyBounds=t}},{key:"_getLineBounds",value:function(t,e){return[Math.min(t.x,e.x)-1,Math.min(t.y,e.y)-1,Math.max(t.x,e.x)+1+1,Math.max(t.y,e.y)+1+1].map((function(t){return Math.floor(t)}))}},{key:"addListener",value:function(t){this._listeners.push(t)}},{key:"removeListener",value:function(t){var e=this._listeners.indexOf(t);e>-1&&this._listeners.splice(e,1)}},{key:"_notifyListeners",value:function(){var t=!0,e=!1,a=void 0;try{for(var n,r=this._listeners[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var i=n.value;i&&i.apply(void 0,arguments)}}catch(l){e=!0,a=l}finally{try{t||null==r.return||r.return()}finally{if(e)throw a}}}},{key:"bounds",get:function(){var t=Object(o.a)(this.shape,2),e=t[0];return[0,0,t[1],e]}}]),t}();var at=function(t){var e=t.shape,a=t.kernels,i=t.onUpdate,l=Object(n.useState)(0),s=Object(o.a)(l,2),u=s[0],c=s[1],h=Object(n.useRef)(null),p=Object(n.useRef)(null),f=Object(n.useRef)(null);Object(n.useEffect)((function(){p.current||(p.current=new _.a(function(t,e){var a=!1;return function(n){n.setup=function(){n.pixelDensity(1);var e=Object(o.a)(t,2),a=e[0],r=e[1];n.createCanvas(a,r),n.strokeWeight(2)},n.draw=function(){if(n.mouseIsPressed){var t={x:n.pmouseX,y:n.pmouseY},r={x:n.mouseX,y:n.mouseY};t.x<0||t.y<0||r.x<0||r.y<0||r.x>=n.width||t.x>=n.width||r.y>=n.height||t.y>=n.height||(n._rotationCache&&(n._rotationCache=null),e.current.addSegment(t,r),a=!0)}else a&&(e.current.update(),a=!1)},n.setRotation=function(t){n._rotationCache||(n._rotationCache=n.get()),n.clear(),n.push(),n.angleMode(n.DEGREES),console.log(t,n._rotationCache),n.translate(n.width/2,n.height/2),n.rotate(t),n.translate(-n.width/2,-n.height/2),n.image(n._rotationCache,0,0),n.pop()}}}(e,f),h.current))})),Object(n.useEffect)((function(){var t=[{filters:a.map((function(t){return[t]})),kernelSize:a[0].length,type:"conv2d"}];f.current=new et(p.current,e,t),f.current.addListener(i),f.current.init()}),[a,e,i]),Object(n.useEffect)((function(){p.current._setupDone&&(p.current.setRotation(u),f.current.forceFullUpdate())}),[u]);var m=Object(n.useCallback)((function(){return f.current.reset()}),[]);return r.a.createElement(d.a,{container:!0,direction:"column",spacing:1,style:{position:"relative"}},r.a.createElement(d.a,{item:!0,style:{margin:"0 auto"}},r.a.createElement("div",{ref:h,className:"zoom300"}),r.a.createElement("div",{style:{marginTop:"10px",textAlign:"center"}},r.a.createElement("span",null,"Make a drawing"),r.a.createElement(W.a,{style:{marginLeft:"10px"},variant:"contained",size:"small",color:"primary","aria-label":"clear",onClick:m},"Clear"))),r.a.createElement(d.a,{item:!0,style:{margin:"20px auto",maxWidth:"200px",minWidth:"160px"}},r.a.createElement("div",null,r.a.createElement(G,{defaultValue:u,track:!1,"aria-labelledby":"drawing rotation",valueLabelDisplay:"auto",marks:[{value:-360,label:"-360"},{value:0,label:"0"},{value:360,label:"360"}],step:1,min:-360,max:360,onChange:function(t,e){return c(e)},timer:20})),r.a.createElement("div",{style:{marginTop:"10px",textAlign:"center"}},"Test rotation invariance")))},nt=["#e6194b","#3cb44b","#4363d8","#f58231","#911eb4","#46f0f0","#f032e6","#bcf60c","#fabebe","#008080","#e6beff","#9a6324","#800000","#aaffc3","#808000","#ffd8b1","#000075"],rt={};var it=function(t){var e=t.kernels,a=t.pt,i=t.ids,l=t.max,o=t.scale,s=t.onSelect,u=Object(n.useRef)(null),c=Object(n.useRef)(null);return Object(n.useEffect)((function(){u.current&&(u.current.innerHTML="",c.current=new _.a(function(t){var e=null,a=null,n=1,r=!1,i=!0;return function(t){t.setData=function(t,i){var l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;e=t;var o=Math.max.apply(Math,Object(k.a)(i.flat()));a=i.map((function(t){return t.map((function(t){return t/o}))})),n=l,r=!0},t.setKernels=function(e){t._kernelCache=[];var a=!0,n=!1,r=void 0;try{for(var i,l=e[Symbol.iterator]();!(a=(i=l.next()).done);a=!0){var o=i.value,s=t._getIcon(o);t._kernelCache.push(s)}}catch(u){n=!0,r=u}finally{try{a||null==l.return||l.return()}finally{if(n)throw r}}},t.setup=function(){t.pixelDensity(1),t.createCanvas(300,300),t.stroke(255),t.noSmooth(),t._colorCodedGraphics=t.createGraphics(300,300)},t.draw=function(){if(e&&a){var l=e.length*n,o=e[0].length*n;l===t.height&&o===t.width||(t.resizeCanvas(o,l),t._colorCodedGraphics=t.createGraphics(e[0].length,e.length));var s=Math.floor(t.mouseX/n),u=Math.floor(t.mouseY/n),c=6*n;if(t._isMouseInBounds()&&i){t.clear(),t._drawBackground(e,a,n);var h=[Math.max(0,s-4),Math.max(0,u-4),Math.min(o/n,s+4+1),Math.min(l/n,u+4+1)],p=h[0],f=h[1],d=h[2],m=h[3],v=C.a.array(e).slice([f,m],[p,d]).tolist(),y=C.a.array(a).slice([f,m],[p,d]).tolist();t.push(),t.translate(s*n-4.5*c,u*n-4.5*c),t.push(),t.fill(255),t.noStroke(),t.rect(0,0,v[0].length*c,v.length*c),t.pop(),t._drawIconArray(v,y,c),t.push(),t.noFill(),t.strokeWeight(1),t.stroke("#b2b2b2"),t.rect(0,0,v[0].length*c,v.length*c),t.pop(),t.push(),t.noFill(),t.stroke("#b2b2b2"),t.strokeWeight(1),t.rect(4*c,4*c,c,c),t.pop(),t.pop(),r=!0}else r&&(t.clear(),t._drawBackground(e,a,n),r=!1)}},t._isMouseInBounds=function(){var e=t.height,a=t.width,r=t.mouseX,i=t.mouseY,l=4*n;return r>l&&i>l&&r<a-l&&i<e-l},t.mouseClicked=function(){if(e&&n&&t._isMouseInBounds()){var a=Math.floor(t.mouseX/n),r=Math.floor(t.mouseY/n);t._onSelect&&(t._onSelect({x:a,y:r}),i=!1,setTimeout((function(){i=!0}),150)),t._pt={x:a,y:r}}},t._drawBackground=function(e,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=t._colorCodedGraphics;r.clear(),r.loadPixels();for(var i=0;i<e.length;i+=1)for(var l=0;l<e[0].length;l+=1)if(a[i][l]>=.1){var o=e[i][l];if(o>=0){var s=t._getColor(o);s.setAlpha(255*a[i][l]),r.set(l,i,s)}}if(r.updatePixels(),t.push(),t.scale(n),t.image(r.get(),0,0),t.pop(),t._pt){var u=t._pt,c=u.x,h=u.y,p=e[h][c],f=a[h][c],d=10;if(t.push(),t.translate((c+.5-d/2)*n,(h+.5-d/2)*n),f>.1){t.fill(255),t.noStroke(),t.rect(0,0,n*d,n*d);var m=t._kernelCache[p];t.image(m,0,0,n*d,n*d),t.noFill(),t.stroke(0),t.rect(0,0,n*d,n*d)}else t.fill(255),t.stroke(0),t.rect(0,0,n*d,n*d);t.pop()}},t._drawIconArray=function(e,a){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=0;r<e.length;r+=1)for(var i=0;i<e[0].length;i+=1){var l=a[r][i];if(l>.1){var o=e[r][i];if(o>=0){var s=t._kernelCache[o];t.push(),t.tint(255,255*l),t.image(s,i*n,r*n,n,n),t.pop()}}}},t._getColor=function(e){var a=rt[e];return a||(a=nt[e]?t.color(nt[e]):t.color([155*Math.random(),155*Math.random(),155*Math.random()]),rt[e]=a),a},t._getIcon=function(e){var a=e.length,n=t.createGraphics(a,a),r=e.flat(),i=Math.max.apply(Math,Object(k.a)(r));i=i>0?i:-Math.min.apply(Math,Object(k.a)(r)),e=e.map((function(t){return t.map((function(t){return t/i}))})),n.loadPixels();for(var l=0;l<e.length;l+=1)for(var o=0;o<e[0].length;o+=1){var s=255*e[l][o];s>0?n.set(o,l,t.color(0,0,0,s)):s<0&&n.set(o,l,t.color(214,30,30,.75*-s))}return n.updatePixels(),n.get()}}}(),u.current))}),[]),Object(n.useEffect)((function(){c.current&&c.current.setKernels(e)}),[e]),Object(n.useEffect)((function(){c.current&&(c.current._pt=a)}),[a]),Object(n.useEffect)((function(){c.current&&i&&l&&c.current.setData(i,l,o)}),[i,l,o]),Object(n.useEffect)((function(){c.current&&(c.current._onSelect=s)}),[s]),r.a.createElement("div",{ref:u,className:"zoom300"})},lt=a(34);function ot(t,e,a){var n=a.map((function(t,e){return{name:e,value:t/255}})),r=4,i=4,l=4,o=4,s=t.offsetWidth-o-i,u=.5*s,c=lt.b().domain(n.map((function(t){return t.name}))).range([o,s-i]).padding(.1),h=lt.c().domain([0,1]).range([u-l,r+c.bandwidth()]),p=lt.d(t).append("svg").attr("width",s).attr("height",u),f=p.append("g").selectAll(".bar").data(n).enter();f.append("rect").attr("fill","#e0e0e0").attr("stroke","#b2b2b2").style("stroke-width",1).attr("x",(function(t){return c(t.name)})).attr("y",(function(t){return h(t.value?t.value:0)})).attr("height",(function(t){return h(0)-h(t.value?t.value:0)})).attr("width",c.bandwidth()),f.exit().remove(),function(t,e,a){var n=[];a.forEach((function(t,e){var a=Math.max.apply(Math,Object(k.a)(t.map((function(t){return Math.max.apply(Math,Object(k.a)(t.map((function(t){return Math.abs(t)}))))}))));t.forEach((function(t,r){return t.forEach((function(t,i){n.push({kIndex:e,row:r,col:i,v:t/a})}))}))}));var r=t.append("g").selectAll(".pixel").data(n).enter(),i=e.bandwidth()/a[0].length;r.append("rect").attr("fill",(function(t){return t.v>=0?"rgba(0, 0, 0, "+t.v+")":"rgba(214, 30, 30, "+.75*-t.v+")"})).style("stroke-width",0).attr("x",(function(t){return e(t.kIndex)+i*t.col})).attr("y",(function(t){return i*t.row})).attr("height",i).attr("width",i),t.append("g").selectAll(".outline").data(a).enter().append("rect").attr("x",(function(t,a){return e(a)})).attr("y",0).attr("height",e.bandwidth()).attr("width",e.bandwidth()).style("stroke","#b2b2b2").style("fill","none").style("stroke-width",1)}(p,c,e);return p.append("g").style("font-size","0").call((function(t){return t.attr("transform","translate(0,".concat(u-l,")")).attr("color","#b2b2b2").call(lt.a(c).tickSize(0))})),p.node()}var st=function(t){var e=Object(n.useRef)(null),a=t.kernels,i=t.acts;return Object(n.useEffect)((function(){e.current.innerHTML="",a&&i&&ot(e.current,a,i)}),[a,i]),r.a.createElement("div",{ref:e,style:t.style})},ut=function(t){var e=t.imgArrs,a=t.imgArrsOverlay,n=t.scale,i=t.overlayOpacity;return r.a.createElement("div",{style:Object(f.a)({},t.style,{position:"relative"})},r.a.createElement(M,{imgArrs:e,scale:n}),r.a.createElement(M,{imgArrs:a,scale:n,style:{position:"absolute",top:"4px",opacity:i||.75}}))};var ct=function(t){var e=t.acts,a=t.kernels,n=t.count,i=t.imgArr,l=t.pt;if(!e||!l||!a||a.length!==e.length)return null;var o=l.x,s=l.y,u=e.map((function(t){return t[s][o]})),c=function(t,e,a){var n=e.x,r=e.y,i=[n-a,r-a,n+a+1,r+a+1],l=i[0],o=i[1],s=i[2],u=i[3];return l<0||o<0||s>t[0].length||u>t.length?null:C.a.array(t).slice([o,u],[l,s]).tolist()}(i,l,(a[0].length-1)/2),h=function(t,e){return t.map((function(t,e){return[e,t]})).sort((function(t,e){return t[1]>e[1]?-1:1})).slice(0,e).map((function(t){return t[0]}))}(u,n);a=h.map((function(t){return a[t]})),u=h.map((function(t){return u[t]}));var p="(".concat(l.x,", ").concat(l.y,")");return r.a.createElement("div",{style:{width:"200px"}},r.a.createElement("div",null,r.a.createElement(st,{kernels:a,acts:u,style:{margin:"10px auto"}}),r.a.createElement("div",{style:{margin:"5px 0 25px 0",textAlign:"center"}},"Top activations at ",p)),c&&r.a.createElement("div",null,r.a.createElement(ut,{imgArrs:new Array(a.length).fill(c),imgArrsOverlay:a,scale:4.5,overlayOpacity:.8,style:{margin:"10px auto"}}),r.a.createElement("div",{style:{margin:"10px 0",textAlign:"center"}},"Kernel overlays at ",p)))};var ht=function(t){var e=t.data,a=t.kernels,i=t.defaultPt,l=Object(n.useState)(i),s=Object(o.a)(l,2),u=s[0],c=s[1],h=Object(n.useMemo)((function(){if(e&&e.network){var t=e.network.getOutput(-1).acts,a=e.network.getOutput(0),n=a.acts,r=a.max,i=a.ids;return{imgArr:t.tolist()[0],acts:n.tolist(),max:r.tolist(),ids:i.tolist()}}return{}}),[e]),p=h.imgArr,f=h.acts,m=h.max,v=h.ids;return r.a.createElement(d.a,{container:!0,spacing:4,justify:"center",style:t.style},r.a.createElement(d.a,{item:!0},r.a.createElement("div",null,r.a.createElement(it,{kernels:a,max:m,ids:v,scale:3,onSelect:c,pt:u}),r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement("div",{style:{marginTop:"10px"}},"Select to inspect")))),r.a.createElement(d.a,{item:!0},r.a.createElement(ct,{kernels:a,imgArr:p,acts:f,pt:u,count:Math.min(8,a.length),style:{width:"400px"}})))},pt=[100,100],ft={x:Math.floor(pt[0]/2)-1,y:Math.floor(pt[1]/2)-1};var dt=function(t){var e=Object(n.useState)(null),a=Object(o.a)(e,2),i=a[0],l=a[1],s=t.kernelSettings,u=s.numComponents,c=s.lambda,h=s.sigma,p=s.windowSize,f=s.types,m=Object(n.useMemo)((function(){return L(p,Math.pow(2,u),c,h,f)}),[u,c,h,p,f]);return r.a.createElement("div",{style:t.style},r.a.createElement(d.a,{container:!0,spacing:4,justify:"center"},r.a.createElement(d.a,{item:!0},r.a.createElement(at,{kernels:m,shape:pt,onUpdate:l})),r.a.createElement(d.a,{item:!0},i&&r.a.createElement(ht,{kernels:m,data:i,defaultPt:ft}))))},mt=a(166);var vt=function(t){var e=t.kernelSettings,a=t.updateKernelSettings;return r.a.createElement("div",null,r.a.createElement("h2",null,"Kernel Tuner"),r.a.createElement(mt.a,{maxWidth:"md"},r.a.createElement(F,{defaultKernelSettings:e,updateKernelSettings:a})),r.a.createElement(mt.a,{maxWidth:"lg",style:{marginTop:"40px"}},r.a.createElement(dt,{kernelSettings:e})))},yt=Object(s.a)({palette:{primary:h.a}}),gt={numComponents:2,lambda:4.9,sigma:3.3,windowSize:9,types:[B[0],B[2]]};var bt="kernelSettings",xt=JSON.parse(localStorage.getItem(bt)),_t=function(t){if(!t)return!1;var e=t.numComponents,a=t.lambda,n=t.sigma,r=t.windowSize,i=t.types;if(isNaN(e)||isNaN(a)||isNaN(n)||isNaN(r))return!1;if(!Array.isArray(i)||0===i.length)return!1;var l=!0,o=!1,s=void 0;try{for(var u,c=i[Symbol.iterator]();!(l=(u=c.next()).done);l=!0){var h=u.value;if(!B.includes(h))return!1}}catch(p){o=!0,s=p}finally{try{l||null==c.return||c.return()}finally{if(o)throw s}}return!0}(xt)?xt:gt;l.a.render(r.a.createElement((function(){var t=Object(n.useState)(_t),e=Object(o.a)(t,2),a=e[0],i=e[1];return Object(n.useEffect)((function(){localStorage.setItem(bt,JSON.stringify(a))}),[a]),r.a.createElement(u.a,{theme:yt},r.a.createElement(vt,{kernelSettings:a,updateKernelSettings:i}))}),null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()}))},94:function(t,e,a){t.exports=a(139)},99:function(t,e,a){}},[[94,1,2]]]);
//# sourceMappingURL=main.91f101c6.chunk.js.map